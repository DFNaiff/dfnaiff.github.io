(()=>{"use strict";var e={9353:(e,t,o)=>{var r=o(7036),n=o(9399),a=o(7904),i=o(784),s=o(863),l=o(2571),c=o(5489),d=o(277),u=o(1111),m=o(3396),g=o(3390),h=o(5346),p=o(3717),f=o(6808);let y=function(e){return e.LOGIN="auth/login",e.LOGOUT="auth/logout",e.HEARTBEAT="auth:heartbeat",e}({}),x=function(e){return e.CREATE_GAME="main/createGame",e.JOIN_GAME="main/joinGame",e.LEAVE_GAME="main/leaveGame",e}({}),b=function(e){return e.ADD_AGENT="game/admin/addAgent",e.START_GAME="game/admin/startGame",e.KICK_PLAYER="game/admin/kickPlayer",e.LEAVE_GAME="game/admin/leaveGame",e.REORDER_PLAYER="game/admin/reorderPlayer",e}({}),T=function(e){return e.PLAY_CARD="game/play/playCard",e.EXTRA_ACTION="game/play/extraAction",e}({}),k=function(e){return e.STATE="broadcast/state",e.GAME_ERROR="broadcast/gameError",e.GAME_ENDED="broadcast/gameEnded",e.GAME_DELETED="broadcast/gameDeleted",e.NOT_IN_GAME="broadcast/notInGame",e}({});const C={socketUrl:"https://suecatatau-server-production.up.railway.app",socketPath:"/socket.io/"};class I{currentUser=null;reconnectAttempts=0;MAX_RECONNECT_ATTEMPTS=5;heartbeatInterval=null;HEARTBEAT_INTERVAL=6e4;eventHandlers=new Map;constructor(){this.socket=(0,f.io)(C.socketUrl,{transports:["websocket","polling"],path:C.socketPath,autoConnect:!1,reconnection:!0,reconnectionAttempts:this.MAX_RECONNECT_ATTEMPTS,reconnectionDelay:1e3,timeout:1e4}),console.log("SocketService constructor called, connecting to:",C.socketUrl),this.setupSocketListeners()}setupSocketListeners(){this.socket.on("connect",(()=>{console.log("Socket CONNECTED, ID:",this.socket.id),this.reconnectAttempts=0})),this.socket.on("disconnect",(e=>{console.log("Socket DISCONNECTED, was ID:",this.socket.id,"Reason:",e),"io server disconnect"===e&&this.socket.connect()})),this.socket.on("connect_error",(e=>{console.error("Connection error:",e),this.reconnectAttempts++,this.reconnectAttempts>=this.MAX_RECONNECT_ATTEMPTS&&(console.error("Max reconnection attempts reached"),this.socket.disconnect())})),this.socket.on("reconnect",(e=>{console.log("Socket RECONNECTED, new ID:",this.socket.id,"Attempt:",e)})),this.socket.on("reconnect_attempt",(e=>{console.log("Socket RECONNECTING, attempt:",e)})),this.socket.on(k.STATE,(e=>{console.log("Received state update for socket ID:",this.socket.id)})),this.socket.on(k.GAME_DELETED,(e=>{console.log("Received game deleted event for socket ID:",this.socket.id,"Game ID:",e.gameId)})),this.socket.on(k.NOT_IN_GAME,(e=>{console.log("Received not in game event for socket ID:",this.socket.id,"Game ID:",e.gameId,"Player ID:",e.playerId),this.triggerEvent(k.NOT_IN_GAME,e)})),this.socket.on("forceDisconnect",(e=>{console.log("[Client Force Disconnect]",{socketId:this.socket.id,userId:this.currentUser?.userId,reason:e.reason,timestamp:(new Date).toISOString()}),this.clearHeartbeat(),this.clearCurrentUser(),this.socket.disconnect()}))}static getInstance(){return I.instance||(I.instance=new I),I.instance}connect(e){return console.log("Connect called, current socket ID:",this.socket.id),new Promise(((e,t)=>{if(this.socket.connected)return console.log("Socket already connected with ID:",this.socket.id),void e();this.socket.connect(),this.socket.on("connect",(()=>{console.log("Connected to server with ID:",this.socket.id),e()})),this.socket.on("connect_error",(e=>{t(e)}))}))}createGame(e,t,o){return new Promise(((r,n)=>{console.log("Emitting createGame event with playerName:",e,"and gameType:",t);const a=setTimeout((()=>{n(new Error("createGame timeout"))}),5e3);this.socket.emit(x.CREATE_GAME,{playerName:e,gameType:t,gameName:o},(e=>{console.log("Received response from createGame:",e),clearTimeout(a),r(e)})),this.socket.on("error",(e=>{console.error("Socket error:",e),n(e)}))}))}joinGame(e,t){return new Promise(((o,r)=>{console.log("Emitting joinGame event with gameId:",e,"playerName:",t);const n=setTimeout((()=>{r(new Error("joinGame timeout"))}),5e3);this.socket.emit(x.JOIN_GAME,{gameId:e,playerName:t},(e=>{console.log("Received response from joinGame:",e),clearTimeout(n),o(e)})),this.socket.on("error",(e=>{console.error("Socket error:",e),r(e)}))}))}addAgent(e){return new Promise((t=>{this.socket.emit(b.ADD_AGENT,{gameId:e},(e=>{t(e)}))}))}startGame(e){return new Promise((t=>{this.socket.emit(b.START_GAME,{gameId:e},(e=>{t(e)}))}))}playCard(e,t){return new Promise((o=>{this.socket.emit(T.PLAY_CARD,{gameId:e,cardIndex:t},(e=>{o(e)}))}))}onGameState(e){console.log("Setting up game state listener for socket:",{socketId:this.socket.id,userId:this.currentUser?.userId,connected:this.socket.connected}),this.socket.onAny(((e,...t)=>{console.log("Received event:",e,"Socket ID:",this.socket.id,"Args:",t)})),this.socket.on(k.STATE,(t=>{console.log("Received game state for socket:",{socketId:this.socket.id,userId:this.currentUser?.userId,state:t}),e(t)})),this.socket.on("connect",(()=>{console.log("Socket connected:",this.socket.id)})),this.socket.on("disconnect",(()=>{console.log("Socket disconnected")}))}disconnect(){this.socket.disconnect()}setupHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),console.log("[Client Heartbeat] Cleared existing heartbeat interval")),console.log("[Client Heartbeat] Setting up new heartbeat interval"),this.heartbeatInterval=setInterval((()=>{if(this.socket.connected&&this.currentUser){console.log("[Client Heartbeat] Sending heartbeat");const e=setTimeout((()=>{console.warn("[Client Heartbeat] Heartbeat response timeout - connection may be stale"),this.socket.disconnect(),this.reconnect().catch((e=>{console.error("Failed to reconnect after heartbeat timeout:",e)}))}),1e4);this.socket.emit(y.HEARTBEAT,{},(t=>{clearTimeout(e),console.log("[Client Heartbeat] Received response:",{socketId:this.socket.id,userId:this.currentUser?.userId,success:t.success,timestamp:(new Date).toISOString()}),t.success||(console.warn("[Client Heartbeat] Failed, initiating logout"),this.logout())}))}else console.log("[Client Heartbeat] Skipped: Socket disconnected or no user",{connected:this.socket.connected,hasUser:!!this.currentUser})}),this.HEARTBEAT_INTERVAL)}clearHeartbeat(){this.heartbeatInterval&&(console.log("[Client Heartbeat] Clearing heartbeat interval"),clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}login(e){return new Promise((t=>{this.socket.connect(),console.log("Logging in with socket ID:",this.socket.id),this.socket.emit(y.LOGIN,{username:e},(o=>{console.log("Login response received for socket:",{socketId:this.socket.id,response:o}),o.success?(this.setCurrentUser(e,o.userId),this.setupHeartbeat()):this.socket.disconnect(),t(o)}))}))}extraAction(e,t,o){return new Promise((r=>{this.socket.emit(T.EXTRA_ACTION,{gameId:e,actionType:t,actionData:o},(e=>{r(e)}))}))}setCurrentUser(e,t){this.currentUser={username:e,userId:t}}getCurrentUser(){return this.currentUser}clearCurrentUser(){this.currentUser=null}async logout(){this.clearHeartbeat(),this.currentUser&&await new Promise((e=>{this.socket.emit(y.LOGOUT,{},(()=>{this.clearCurrentUser(),this.socket.disconnect(),e()}))}))}leaveGame(e){return new Promise(((t,o)=>{console.log("Emitting leaveGame event with gameId:",e);const r=setTimeout((()=>{o(new Error("leaveGame timeout"))}),5e3);this.socket.emit(x.LEAVE_GAME,{gameId:e},(e=>{console.log("Received response from leaveGame:",e),clearTimeout(r),t(e)})),this.socket.on("error",(e=>{console.error("Socket error:",e),o(e)}))}))}kickPlayer(e,t){this.socket.emit(b.KICK_PLAYER,{gameId:e,playerId:t})}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,[]),this.eventHandlers.get(e)?.push(t)}off(e,t){if(!this.eventHandlers.has(e))return;const o=this.eventHandlers.get(e)||[],r=o.indexOf(t);-1!==r&&o.splice(r,1)}triggerEvent(e,...t){(this.eventHandlers.get(e)||[]).forEach((e=>e(...t)))}isConnected(){return this.socket.connected}reconnect(){return new Promise(((e,t)=>{if(this.socket.connected)return console.log("Socket already connected, no need to reconnect"),void e();console.log("Attempting to reconnect socket...");const o=setTimeout((()=>{t(new Error("Socket reconnection timeout"))}),5e3),r=()=>{clearTimeout(o),this.socket.off("connect",r),this.socket.off("connect_error",n),this.currentUser?this.login(this.currentUser.username).then((o=>{o.success?(console.log("Re-authenticated after reconnect"),e()):t(new Error("Failed to re-authenticate after reconnection"))})).catch(t):e()},n=e=>{clearTimeout(o),this.socket.off("connect",r),this.socket.off("connect_error",n),t(e)};this.socket.on("connect",r),this.socket.on("connect_error",n),this.socket.connect()}))}getSocket(){return this.socket}reorderPlayer(e,t,o){this.socket.emit(b.REORDER_PLAYER,{gameId:e,playerId:t,direction:o})}isLoggedIn(){return!!this.currentUser}}var S=o(575);const B={cardBackground:"white",cardBorder:"#ddd",cardTextBlack:"black",cardTextRed:"red",dialogOverlay:"rgba(0, 0, 0, 0.5)",dialogBackground:"white",dialogCancelButton:"#666",dialogConfirmButton:"#d32f2f",dialogButtonText:"white",leaveButtonBackground:"#d32f2f",leaveButtonText:"white",playerInfoBackground:"rgba(255, 255, 255, 0.9)",playerInfoBorder:"#ccc",currentPlayerText:"#4CAF50",playerStatsText:"#666",trumpInfoBackground:"rgba(255, 255, 255, 0.9)",trumpInfoBorder:"#ccc",teamScoreCardBackground:"rgba(255, 255, 255, 0.6)",teamScoreCardBorder:"rgba(0, 0, 0, 0.1)",inputBorder:"#ddd",inputBackground:"white",inputText:"black",placeholderText:"gray",tableFelt:"#1B5E20",tableEdge:"#4A3211",statusText:"#000000",subtitleText:"#000000",playerTeamBackground:"rgba(220, 242, 220, 0.7)",playerTeamBorder:"rgba(76, 175, 80, 0.3)",teamScoreText:"#333",playerTeamScoreText:"#1B5E20",accent:"#66bb6a",welcomeText:"#000000",logoutButton:"#d32f2f",primaryButton:"#2196f3",primaryButtonText:"white",appBackground:"#e8f5e9",containerBackground:"#e8f5e9",pickerBackground:"#e0f2f1",titleText:"#000000",winningPlayerBackground:"#4a9eff30",winningPlayerBorder:"#4a9eff",shareButtonBackground:"#4CAF50",shareButtonText:"white"},w={cardBackground:"#2c2c2c",cardBorder:"#444",cardTextBlack:"#e0e0e0",cardTextRed:"#ff6b6b",dialogOverlay:"rgba(0, 0, 0, 0.7)",dialogBackground:"#2c2c2c",dialogCancelButton:"#555",dialogConfirmButton:"#b71c1c",dialogButtonText:"#e0e0e0",leaveButtonBackground:"#b71c1c",leaveButtonText:"#e0e0e0",playerInfoBackground:"rgba(40, 40, 40, 0.9)",playerInfoBorder:"#444",currentPlayerText:"#66bb6a",playerStatsText:"#aaa",trumpInfoBackground:"rgba(40, 40, 40, 0.9)",trumpInfoBorder:"#444",teamScoreCardBackground:"rgba(40, 40, 40, 0.6)",teamScoreCardBorder:"rgba(255, 255, 255, 0.1)",inputBorder:"#444",inputBackground:"#222",inputText:"#e0e0e0",placeholderText:"#aaa",tableFelt:"#0c3912",tableEdge:"#2A1901",statusText:"#e0e0e0",subtitleText:"#e0e0e0",playerTeamBackground:"rgba(40, 97, 40, 0.7)",playerTeamBorder:"rgba(76, 175, 80, 0.3)",teamScoreText:"#e0e0e0",playerTeamScoreText:"#66bb6a",accent:"#66bb6a",welcomeText:"#e0e0e0",logoutButton:"#b71c1c",primaryButton:"#1565c0",primaryButtonText:"#e0e0e0",appBackground:"#121212",containerBackground:"#121212",pickerBackground:"#333",titleText:"#e0e0e0",winningPlayerBackground:"#4a9eff30",winningPlayerBorder:"#4a9eff",shareButtonBackground:"#4CAF50",shareButtonText:"white"},j=(0,n.createContext)({themeType:"light",colors:B,setThemeType:()=>{},toggleTheme:()=>{}}),v=({children:e})=>{const[t,o]=(0,n.useState)("dark"),r="light"===t?B:w;return(0,S.jsx)(j.Provider,{value:{themeType:t,colors:r,setThemeType:o,toggleTheme:()=>{o((e=>"light"===e?"dark":"light"))}},children:e})},E=()=>{const e=(0,n.useContext)(j);if(void 0===e)throw new Error("useTheme must be used within a ThemeProvider");return e},A={alert(e,t,o,r){if(o&&0!==o.length)if(1===o.length)window.alert(`${e}\n\n${t}`),o[0].onPress&&o[0].onPress();else if(2===o.length){const r=window.confirm(`${e}\n\n${t}`),n=o.find((e=>"cancel"!==e.style)),a=o.find((e=>"cancel"===e.style));r&&n?.onPress?n.onPress():!r&&a?.onPress&&a.onPress()}else{window.alert(`${e}\n\n${t}`);const r=o.find((e=>"cancel"!==e.style));r?.onPress&&r.onPress()}else window.alert(`${e}\n\n${t}`)}},P=({navigation:e,route:t})=>{const[o,r]=(0,n.useState)(""),i=I.getInstance(),{colors:l}=E(),c=t.params?.gameId,d=s.default.create({container:{flex:1,padding:20,justifyContent:"center",backgroundColor:l.containerBackground},title:{fontSize:24,textAlign:"center",marginBottom:30,color:l.titleText},input:{borderWidth:1,borderColor:l.inputBorder,backgroundColor:l.inputBackground,padding:10,marginBottom:20,borderRadius:5,color:l.titleText},buttonContainer:{marginTop:10},button:{backgroundColor:l.primaryButton,padding:12,borderRadius:5,alignItems:"center"},buttonText:{color:l.primaryButtonText,fontSize:16,fontWeight:"bold"},subtitle:{fontSize:16,marginBottom:10}});(0,n.useEffect)((()=>{c&&console.log("LoginScreen received gameId:",c)}),[c]);return(0,S.jsxs)(a.default,{style:d.container,children:[(0,S.jsx)(h.default,{style:d.title,children:c?"Enter Your Username to Join Game":"Enter Your Username"}),c&&(0,S.jsxs)(h.default,{style:[d.subtitle,{color:l.subtitleText}],children:["You're joining game: ",c]}),(0,S.jsx)(g.default,{style:d.input,onChangeText:r,value:o,placeholder:"Username",placeholderTextColor:l.playerStatsText,autoCapitalize:"none",autoCorrect:!1}),(0,S.jsx)(a.default,{style:d.buttonContainer,children:(0,S.jsx)(p.default,{style:d.button,onPress:async()=>{if(o.trim())try{console.log("Logging in with username:",o);const r=await i.login(o);if(r.success)if(i.setCurrentUser(o,r.userId),console.log("Login successful."),c){console.log("Joining game directly with ID:",c);try{await i.connect(o);const t=await i.joinGame(c,o);if(t.success)e.replace("Game",{gameId:c,playerName:o});else{const o=t.error||"Could not join the game. You will be redirected to the home screen.";A.alert("Game Join Failed",o,[{text:"OK",onPress:()=>e.replace("Home")}])}}catch(t){console.error("Error joining game:",t),A.alert("Connection Error","Failed to connect to the game server. Please try again later.",[{text:"OK",onPress:()=>e.replace("Home")}])}}else e.replace("Home");else{console.log("Login failed:",r.error||"Username already taken");const e=r.error||"This username is already in use. Please choose a different one.";A.alert("Login Failed",e)}}catch(t){console.error("Server connection error:",t),A.alert("Connection Error","Could not connect to the server. Please check your internet connection and try again.")}else A.alert("Error","Please enter a username")},children:(0,S.jsx)(h.default,{style:d.buttonText,children:c?"Login & Join Game":"Login"})})})]})};var G=o(6729);const R=({navigation:e})=>{const{colors:t,toggleTheme:o,themeType:r}=E(),n=I.getInstance(),i=n.getCurrentUser()?.username,l=s.default.create({container:{flex:1,padding:20,justifyContent:"center"},welcome:{fontSize:24,textAlign:"center",marginBottom:30,color:t.welcomeText},buttonContainer:{gap:10}});return(0,S.jsxs)(a.default,{style:[l.container,{backgroundColor:t.containerBackground}],children:[(0,S.jsxs)(h.default,{style:l.welcome,children:["Welcome, ",i,"!"]}),(0,S.jsxs)(a.default,{style:l.buttonContainer,children:[(0,S.jsx)(G.default,{title:"Create Game",onPress:()=>{console.log("Creating game"),e.navigate("GameCreation",{playerName:i})},color:t.primaryButton}),(0,S.jsx)(G.default,{title:"Join Game",onPress:()=>{console.log("Joining game"),e.navigate("JoinGame",{playerName:i})},color:t.primaryButton}),(0,S.jsx)(G.default,{title:"Logout",onPress:async()=>{await n.logout(),console.log("Logging out"),e.replace("Login")},color:t.logoutButton})]})]})};var N=o(5318),_=o(6905),D=o(9367);const L=({gameId:e,onAddAgent:t,onStartGame:o,playerCount:r,players:n,isOwner:i,onKickPlayer:l,onReorderPlayer:c,gameCharacteristics:d})=>{const{colors:u}=E(),m=s.default.create({container:{flex:1,padding:20},subtitle:{fontSize:18,fontWeight:"bold",marginBottom:10},controls:{flexDirection:"column",justifyContent:"space-around",marginTop:20},playerListContainer:{marginTop:10,marginBottom:10,height:160,borderWidth:1,borderColor:"#ddd",borderRadius:5},playerList:{flex:1},playerRow:{flexDirection:"row",justifyContent:"space-between",paddingVertical:8,paddingHorizontal:10,borderBottomWidth:1,borderBottomColor:"#eee",alignItems:"center"},playerName:{fontSize:16,flex:1},playerActions:{flexDirection:"row",alignItems:"center",justifyContent:"flex-end"},actionButton:{paddingHorizontal:2},kickButton:{color:"red",fontSize:18,fontWeight:"bold"},moveButton:{fontSize:18,fontWeight:"bold",width:18,textAlign:"center"},upButton:{color:"green"},downButton:{color:"blue"},buttonSpacer:{marginTop:10}}),g=r>=(d?.minPlayers||2)&&r<=(d?.maxPlayers||1/0)&&r%(d?.playerGroupSize||1)===0;return(0,S.jsxs)(a.default,{style:m.container,children:[(0,S.jsx)(h.default,{style:[m.subtitle,{color:u.titleText}],children:"Game Setup"}),(0,S.jsxs)(h.default,{style:{color:u.statusText},children:["Players: ",r," (Min: ",d?.minPlayers||2,")"]}),(0,S.jsx)(a.default,{style:m.playerListContainer,children:(0,S.jsx)(D.default,{style:m.playerList,children:n.map(((e,t)=>(0,S.jsxs)(a.default,{style:m.playerRow,children:[(0,S.jsxs)(h.default,{style:[m.playerName,{color:u.statusText}],children:[e.name," ",e.isAgent?"(AI)":""," ",e.isOwner?"(Owner)":""]}),i&&!e.isOwner&&(0,S.jsxs)(a.default,{style:m.playerActions,children:[(0,S.jsx)(p.default,{onPress:()=>c(e.id,"up"),style:m.actionButton,children:(0,S.jsx)(h.default,{style:[m.moveButton,m.upButton],children:"\u2191"})}),(0,S.jsx)(p.default,{onPress:()=>c(e.id,"down"),style:m.actionButton,children:(0,S.jsx)(h.default,{style:[m.moveButton,m.downButton],children:"\u2193"})}),(0,S.jsx)(p.default,{onPress:()=>l(e.id),style:m.actionButton,children:(0,S.jsx)(h.default,{style:m.kickButton,children:"\u2715"})})]})]},e.id)))})}),(0,S.jsx)(a.default,{style:m.controls,children:i&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(G.default,{title:"Add AI Player",onPress:t}),g&&(0,S.jsx)(a.default,{style:m.buttonSpacer,children:(0,S.jsx)(G.default,{title:"Start Game",onPress:o})})]})})]})};var O=o(3296);o(9251);const H=({card:e,onPress:t,disabled:o})=>{const{colors:r}=E(),n=s.default.create({card:{width:60,height:90,backgroundColor:r.cardBackground,borderRadius:8,borderWidth:1,borderColor:r.cardBorder,padding:5,margin:2,alignItems:"center",justifyContent:"center"},disabled:{opacity:.5},value:{fontSize:24,color:r.cardTextBlack},suit:{fontSize:32,color:r.cardTextBlack},redText:{color:r.cardTextRed}}),a="hearts"===e.suit||"diamonds"===e.suit;return(0,S.jsxs)(p.default,Object.assign({style:[n.card,o&&n.disabled],className:"card-hover",onPress:t,disabled:o},{style:[n.card,o&&n.disabled,{cursor:"pointer"}]},{children:[(0,S.jsx)(h.default,{style:[n.value,a&&n.redText],children:{11:"J",12:"Q",13:"K",14:"A"}[e.value]||e.value}),(0,S.jsx)(h.default,{style:[n.suit,a&&n.redText],children:{hearts:"\u2665",diamonds:"\u2666",clubs:"\u2663",spades:"\u2660"}[e.suit]})]}))},M={TABLE_SIZE:280,TABLE_MEMBERS_EXPANSION_FACTOR:2.5,CARD_RADIUS_FACTOR:.5,PLAYER_RADIUS_FACTOR:.5,MIN_GAME_AREA_HEIGHT:350,CARD_SIZE:{width:60,height:85},PLAYER_INFO_MIN_WIDTH:80},U=({gameState:e,playerName:t,playerId:o,onPlayCard:r,onExtraAction:n})=>{const{colors:i}=E(),l=s.default.create({container:{flex:1,position:"relative",padding:10,width:"100%",alignSelf:"center",display:"flex",flexDirection:"column"},headerRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:10},status:{fontSize:16,flex:1,color:i.statusText},subtitle:{fontSize:18,fontWeight:"bold",marginBottom:5,color:i.subtitleText},trickContainer:{position:"absolute",width:"100%",height:"100%",alignItems:"center",justifyContent:"center",zIndex:1},trickTable:{position:"relative",alignItems:"center",justifyContent:"center"},tableBackground:{position:"absolute",width:"100%",height:"100%",borderRadius:1e3,backgroundColor:i.tableFelt,borderWidth:4,borderColor:i.tableEdge},cardPositioner:{position:"absolute",width:0,height:0,alignItems:"center",justifyContent:"center"},trickCardContainer:{position:"absolute",alignItems:"center"},handContainer:{width:"100%",marginTop:5,marginBottom:10,flexShrink:0},handWrapper:{width:"100%",height:100},handContent:{alignItems:"center",paddingHorizontal:5},hand:{flexGrow:0},extraActionContainer:{marginTop:10,marginBottom:10},gameArea:{flex:1,position:"relative",marginVertical:10},playAreaContainer:{width:"100%",height:"100%",position:"relative",alignItems:"center",justifyContent:"center"},playerTable:{position:"absolute",width:0,height:0,alignItems:"center",justifyContent:"center",zIndex:2},playerInfo:{position:"absolute",alignItems:"center",backgroundColor:i.playerInfoBackground,padding:8,borderRadius:8,minWidth:80,borderWidth:1,borderColor:i.playerInfoBorder},winningPlayerInfo:{backgroundColor:i.winningPlayerBackground||"#4a9eff30",borderColor:i.winningPlayerBorder||"#4a9eff"},playerNameFixed:{fontSize:12,fontWeight:"bold",marginBottom:2},currentPlayerName:{color:i.currentPlayerText,fontWeight:"bold"},playerStats:{fontSize:10,color:i.playerStatsText},trumpInfo:{position:"absolute",top:5,right:5,alignItems:"center",backgroundColor:i.trumpInfoBackground,padding:5,borderRadius:6,borderWidth:1,borderColor:i.trumpInfoBorder,zIndex:10},trumpTitle:{fontSize:14,fontWeight:"bold",marginBottom:4},trumpHolder:{fontSize:12,color:i.playerStatsText,marginTop:4},teamScoreContainer:{flexDirection:"row",justifyContent:"flex-end",gap:5},teamScoreCard:{backgroundColor:i.teamScoreCardBackground,borderRadius:4,paddingVertical:3,paddingHorizontal:6,minWidth:50,alignItems:"center",borderWidth:1,borderColor:i.teamScoreCardBorder},playerTeamCard:{backgroundColor:i.playerTeamBackground,borderColor:i.playerTeamBorder},teamName:{fontSize:12,fontWeight:"500",textAlign:"center"},teamScore:{fontSize:14,fontWeight:"bold",color:i.teamScoreText},playerTeamScore:{color:i.playerTeamScoreText}}),c=e.public.currentPlayerIndex,d=e.public.players[c].id===o,u=e.public.gameSpecificData?.isResolvingTrick,m=e.public.isResolvingTurnEnd,g=e.public.isResolvingGameEnd,p=e.private?.hand||[],f=e.public.gameSpecificData?.currentTrick||[],y=e.public.gameSpecificData?.scores||[],x=e.public.gameSpecificData?.canToggle,b=e.public.gameSpecificData?.trumpCard,T=e.public.gameSpecificData?.trumpHolder,k=e.public.gameSpecificData?.teams||[],C=e.public.gameSpecificData?.gamePoints||[],I=k.findIndex((e=>e.includes(o))),B=O.default.get("window").width,w=O.default.get("window").height,j=W(B,w),v=M;return(0,S.jsxs)(a.default,{style:l.container,children:[(0,S.jsxs)(a.default,{style:l.headerRow,children:[(0,S.jsx)(h.default,{style:l.status,children:g?"Game ending...":m?"Round ending...":u?"Resolving trick...":d?"Your turn!":`Waiting for ${e.public.players[c].name}`}),k&&0!==k.length&&C?(0,S.jsx)(a.default,{style:l.teamScoreContainer,children:k.map(((e,t)=>{const o=C[t]||0,r=t===I;return(0,S.jsxs)(a.default,{style:[l.teamScoreCard,r&&l.playerTeamCard],children:[(0,S.jsxs)(h.default,{style:l.teamName,children:["Team ",t+1,r?" \u2605":""]}),(0,S.jsx)(h.default,{style:[l.teamScore,r&&l.playerTeamScore],children:o})]},`team-${t}`)}))}):null]}),(0,S.jsx)(a.default,{style:[l.gameArea,j.gameArea,{minHeight:v.MIN_GAME_AREA_HEIGHT}],children:(0,S.jsxs)(a.default,{style:l.playAreaContainer,children:[(()=>{if(!b||!T)return null;const t=e.public.players.find((e=>e.id===T))?.name;return(0,S.jsxs)(a.default,{style:l.trumpInfo,children:[(0,S.jsx)(h.default,{style:l.trumpTitle,children:"Trump Card:"}),(0,S.jsx)(H,{card:b}),(0,S.jsxs)(h.default,{style:l.trumpHolder,children:["Held by: ",t]})]})})(),(()=>{const t=e.public.players.findIndex((e=>e.id===o)),r=e.public.players.length,n=v.TABLE_SIZE/2*v.CARD_RADIUS_FACTOR,i=e=>{const o=(e-t+r)%r,a=-Math.PI/2-2*o*Math.PI/r;return{position:"absolute",transform:[{translateX:-n*Math.cos(a)},{translateY:-n*Math.sin(a)},{rotate:`${a+Math.PI/2}rad`}]}};return(0,S.jsx)(a.default,{style:l.trickContainer,children:(0,S.jsxs)(a.default,{style:[l.trickTable,{width:v.TABLE_SIZE,height:v.TABLE_SIZE}],children:[(0,S.jsx)(a.default,{style:l.tableBackground}),(0,S.jsx)(a.default,{style:l.cardPositioner,children:f?.map((({playerId:t,card:o})=>{const r=e.public.players.findIndex((e=>e.id===t));return(0,S.jsx)(a.default,{style:[l.trickCardContainer,i(r),{width:v.CARD_SIZE.width,height:v.CARD_SIZE.height}],children:(0,S.jsx)(H,{card:o})},t)}))})]})})})(),(()=>{const t=e.public.players.findIndex((e=>e.id===o)),r=e.public.players.length,n=v.TABLE_SIZE/2*v.PLAYER_RADIUS_FACTOR*v.TABLE_MEMBERS_EXPANSION_FACTOR,i=(()=>{if(!m||!k||!y)return[];const e=k.map((e=>e.reduce(((e,t)=>e+(y.find((e=>e.playerId===t))?.score||0)),0))),t=Math.max(...e);return e.map(((e,o)=>e===t?o:-1)).filter((e=>-1!==e))})(),s=e=>{const o=(e-t+r)%r,a=-Math.PI/2-2*o*Math.PI/r;return{position:"absolute",transform:[{translateX:-n*Math.cos(a)},{translateY:-n*Math.sin(a)}]}};return(0,S.jsx)(a.default,{style:l.playerTable,children:e.public.players.map(((t,r)=>{const n=e.public.gameSpecificData?.scores?.find((e=>e.playerId===t.id))?.score||0,c=k.findIndex((e=>e.includes(t.id))),d=i.includes(c);return(0,S.jsxs)(a.default,{style:[l.playerInfo,s(r),{minWidth:v.PLAYER_INFO_MIN_WIDTH},d&&m&&l.winningPlayerInfo],children:[(0,S.jsx)(h.default,{style:[l.playerNameFixed,t.id===o&&l.currentPlayerName],children:t.name}),(m||e.public.isResolvingGameEnd)&&(0,S.jsxs)(h.default,{style:l.playerStats,children:["Points: ",n]})]},t.id)}))})})()]})}),(0,S.jsxs)(a.default,{style:l.handContainer,children:[(0,S.jsx)(h.default,{style:l.subtitle,children:"Your Hand:"}),(0,S.jsx)(a.default,{style:l.handWrapper,children:(0,S.jsx)(D.default,{horizontal:!0,contentContainerStyle:l.handContent,children:p.map(((e,t)=>(0,S.jsx)(H,{card:e,onPress:()=>d&&r(t)},t)))})}),d&&x&&n?(0,S.jsx)(a.default,{style:l.extraActionContainer,children:(0,S.jsx)(G.default,{title:`Toggle ${e.public.gameSpecificData?.isHighWins?"High":"Low"} Wins`,onPress:()=>n("TOGGLE_WIN_CONDITION",{})})}):null]})]})},W=(e,t)=>({gameArea:{maxHeight:.6*t},playerTable:e<=768?{maxWidth:350,maxHeight:350}:{maxWidth:450,maxHeight:450}}),z=({teams:e,gamePoints:t,playerId:o,players:r,gamePointsReversed:n})=>{const{colors:i}=E(),l=s.default.create({container:{flex:1,padding:20},title:{fontSize:24,fontWeight:"bold",textAlign:"center",marginBottom:10},subtitle:{fontSize:18,textAlign:"center",marginBottom:20},scoreList:{flex:1},teamRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:15,backgroundColor:i.teamScoreCardBackground,borderRadius:8,marginBottom:10,borderWidth:1,borderColor:i.teamScoreCardBorder},playerTeamRow:{backgroundColor:i.playerTeamBackground,borderColor:i.playerTeamBorder},winnerRow:{borderWidth:2,borderColor:"gold"},rankAndTeam:{flexDirection:"row",flex:1,alignItems:"flex-start"},rank:{fontSize:18,fontWeight:"bold",marginRight:10,width:25},teamMembers:{flex:1},teamTitle:{fontSize:16,fontWeight:"bold",marginBottom:5},playerName:{fontSize:14,marginLeft:10,color:i.statusText},currentPlayerName:{fontWeight:"bold",color:i.currentPlayerText},playerTeamText:{color:i.playerTeamScoreText},points:{fontSize:18,fontWeight:"bold",color:i.teamScoreText}}),c=e.findIndex((e=>e.includes(o))),d=[...e.map(((e,o)=>({teamIndex:o,teamMembers:e,points:t[o]||0,isPlayerTeam:o===c})))].sort(((e,t)=>n?e.points-t.points:t.points-e.points));return(0,S.jsxs)(a.default,{style:l.container,children:[(0,S.jsx)(h.default,{style:[l.title,{color:i.titleText}],children:"Game Finished"}),(0,S.jsx)(h.default,{style:[l.subtitle,{color:i.subtitleText}],children:"Final Scores"}),(0,S.jsx)(D.default,{style:l.scoreList,children:d.map(((e,t)=>{const n=0===t;return(0,S.jsxs)(a.default,{style:[l.teamRow,e.isPlayerTeam&&l.playerTeamRow,n&&l.winnerRow],children:[(0,S.jsxs)(a.default,{style:l.rankAndTeam,children:[(0,S.jsxs)(h.default,{style:[l.rank,e.isPlayerTeam&&l.playerTeamText],children:[t+1,"."]}),(0,S.jsxs)(a.default,{style:l.teamMembers,children:[(0,S.jsxs)(h.default,{style:[l.teamTitle,e.isPlayerTeam&&l.playerTeamText],children:["Team ",e.teamIndex+1," ",e.isPlayerTeam&&"(Your Team)",n&&" \ud83c\udfc6"]}),e.teamMembers.map((t=>{const n=r.find((e=>e.id===t));return(0,S.jsxs)(h.default,{style:[l.playerName,t===o&&l.currentPlayerName,e.isPlayerTeam&&l.playerTeamText],children:[n?.name||"Unknown"," ",t===o&&"(You)",n?.isAgent&&" (AI)"]},t)}))]})]}),(0,S.jsxs)(h.default,{style:[l.points,e.isPlayerTeam&&l.playerTeamText],children:[e.points," pts"]})]},`team-${e.teamIndex}`)}))})]})};let F=function(e){return e.WAITING="WAITING",e.PLAYING="PLAYING",e.FINISHED="FINISHED",e}({});var Y=o(3681);const $=({visible:e,title:t,message:o,onConfirm:r,onCancel:n})=>{const{colors:i}=E(),l=s.default.create({overlay:{flex:1,backgroundColor:i.dialogOverlay,justifyContent:"center",alignItems:"center"},dialog:{backgroundColor:i.dialogBackground,borderRadius:10,padding:20,width:"80%",maxWidth:400},title:{fontSize:18,fontWeight:"bold",marginBottom:10,textAlign:"center"},message:{fontSize:16,marginBottom:20,textAlign:"center"},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},button:{flex:1,padding:10,borderRadius:5,marginHorizontal:5},cancelButton:{backgroundColor:i.dialogCancelButton},confirmButton:{backgroundColor:i.dialogConfirmButton},buttonText:{color:i.dialogButtonText,textAlign:"center",fontSize:16}});return(0,S.jsx)(Y.default,{transparent:!0,visible:e,animationType:"fade",onRequestClose:n,children:(0,S.jsx)(a.default,{style:l.overlay,children:(0,S.jsxs)(a.default,{style:l.dialog,children:[(0,S.jsx)(h.default,{style:l.title,children:t}),(0,S.jsx)(h.default,{style:l.message,children:o}),(0,S.jsxs)(a.default,{style:l.buttonContainer,children:[(0,S.jsx)(p.default,{style:[l.button,l.cancelButton],onPress:n,children:(0,S.jsx)(h.default,{style:l.buttonText,children:"Cancel"})}),(0,S.jsx)(p.default,{style:[l.button,l.confirmButton],onPress:r,children:(0,S.jsx)(h.default,{style:l.buttonText,children:"Leave Game"})})]})]})})})};var J=o(698);const K=({gameId:e,style:t})=>{const[o,r]=(0,n.useState)(!1),a=(0,J.useNavigation)(),i=I.getInstance(),{colors:l}=E(),c=s.default.create({leaveButton:{backgroundColor:l.leaveButtonBackground,padding:10,borderRadius:5,position:"absolute",top:10,right:10},leaveButtonText:{color:l.leaveButtonText,fontSize:16,fontWeight:"bold"}});return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(p.default,{style:[c.leaveButton,t],onPress:()=>r(!0),children:(0,S.jsx)(h.default,{style:c.leaveButtonText,children:"Leave Game"})}),(0,S.jsx)($,{visible:o,title:"Leave Game",message:"Are you sure you want to leave this game? This action cannot be undone.",onConfirm:async()=>{try{(await i.leaveGame(e)).success?a.reset({index:0,routes:[{name:"Home"}]}):console.error("Failed to leave game")}catch(t){console.error("Error leaving game:",t)}r(!1)},onCancel:()=>r(!1)})]})},V=({gameId:e,style:t,isOwner:o})=>{const{colors:r}=E(),n=s.default.create({shareButton:{backgroundColor:r.shareButtonBackground,padding:10,borderRadius:5},shareButtonText:{color:r.shareButtonText,fontSize:16,fontWeight:"bold"}});if(!o)return null;return(0,S.jsx)(p.default,{style:[n.shareButton,t],onPress:async()=>{let t;{const o=window.location.pathname,r=o.endsWith("/")?o:o.substring(0,o.lastIndexOf("/")+1);t=window.location.hostname.includes("github.io")?`${window.location.origin}${r}?gameId=${e}`:`${window.location.origin}${r}game/${e}`,console.log("Generated share URL:",t)}const o=t;try{navigator.clipboard.writeText(o||"").then((()=>{A.alert("Success","Game link copied to clipboard! Share it with your friends.")})).catch((()=>{A.alert("Error","Failed to copy the game link.")}))}catch(r){console.error("Error sharing:",r),A.alert("Error","Could not share the game link")}},children:(0,S.jsx)(h.default,{style:n.shareButtonText,children:"Share Game Link"})})},X=({route:e})=>{const{gameId:t,playerName:o}=e.params,[r,i]=(0,n.useState)(null),[l,c]=(0,n.useState)({mode:"management",isCurrentPlayer:!1}),[d,u]=(0,n.useState)(!1),[m,g]=(0,n.useState)(_.default.currentState),p=I.getInstance(),{colors:f}=E(),y=(0,J.useNavigation)();console.log("GameScreen mounted with gameId:",t,"and playerName:",o),(0,J.useFocusEffect)((0,n.useCallback)((()=>{const e=()=>(u(!0),!0);return N.default.addEventListener("hardwareBackPress",e),y.setOptions({headerLeft:()=>null}),()=>N.default.removeEventListener("hardwareBackPress",e)}),[y])),(0,n.useEffect)((()=>{const e=_.default.addEventListener("change",(e=>{console.log("App state changed from",m,"to",e),m.match(/inactive|background/)&&"active"===e&&(console.log("App has come back to the foreground!"),p.isConnected()||(console.log("Socket disconnected while app was in background, attempting to reconnect..."),p.reconnect().catch((e=>{console.error("Failed to reconnect socket:",e),A.alert("Connection Lost","Your connection to the game was lost. Please log in again.",[{text:"OK",onPress:()=>y.reset({index:0,routes:[{name:"Login"}]})}])})))),g(e)}));return()=>{e.remove()}}),[m,y]),(0,n.useEffect)((()=>{console.log("useEffect called");const e=e=>{console.log("handleNotInGame called with data:",e),console.log("currentGameId:",t),console.log("currentUserId:",p.getCurrentUser()?.userId),e.gameId===t&&e.playerId===p.getCurrentUser()?.userId&&(console.log("Navigating to Home screen due to NOT_IN_GAME event"),y.reset({index:0,routes:[{name:"Home"}]}))};return p.on(k.NOT_IN_GAME,e),p.onGameState((e=>{console.log("Game state received:",e),i(e),c((t=>Object.assign({},t,{mode:"PLAYING"===e.public.phase?"playing":"management",isCurrentPlayer:e.public.players[e.public.currentPlayerIndex]?.name===o})))})),()=>{p.off(k.NOT_IN_GAME,e)}}),[t,y]);const x=()=>{p.addAgent(t)},b=()=>{p.startGame(t)},T=e=>{p.playCard(t,e)},C=(e,o)=>{p.extraAction(t,e,o)},B=e=>{p.kickPlayer(t,e)},w=(e,o)=>{p.reorderPlayer(t,e,o)};if(!r)return(0,S.jsx)(h.default,{children:"Loading..."});const j=s.default.create({container:{flex:1,padding:20,position:"relative"},headerButtons:{flexDirection:"row",justifyContent:"space-between",width:"100%",padding:10,marginBottom:10},title:{fontSize:24,fontWeight:"bold",marginTop:10,textAlign:"center"},subtitle:{fontSize:18,fontWeight:"bold",marginBottom:10},controls:{flexDirection:"row",justifyContent:"space-around",marginBottom:20},status:{fontSize:16,marginBottom:20},trickContainer:{marginBottom:20},trick:{flexGrow:0,height:100},handContainer:{marginTop:"auto"},hand:{flexGrow:0,height:100},scoreboard:{marginTop:20}});return(0,S.jsxs)(a.default,{style:[j.container,{backgroundColor:f.containerBackground}],children:[(0,S.jsxs)(a.default,{style:j.headerButtons,children:[(0,S.jsx)(V,{gameId:t,isOwner:r?.public?.owner===p.getCurrentUser()?.userId}),(0,S.jsx)(K,{gameId:t})]}),(0,S.jsx)(h.default,{style:[j.title,{color:f.titleText}],children:t}),r.public.phase===F.FINISHED?(0,S.jsx)(z,{teams:r.public.gameSpecificData?.teams||[],gamePoints:r.public.gameSpecificData?.gamePoints||[],playerId:p.getCurrentUser()?.userId||"",players:r.public.players,gamePointsReversed:r.public.gameCharacteristics.gamePointsReversed}):"management"===l.mode?(0,S.jsx)(L,{gameId:t,onAddAgent:x,onStartGame:b,playerCount:r.public.players.length,players:r.public.players.map((e=>Object.assign({},e,{isOwner:e.id===r.public.owner}))),isOwner:r.public.owner===p.getCurrentUser()?.userId,onKickPlayer:B,onReorderPlayer:w,gameCharacteristics:r.public.gameCharacteristics}):(0,S.jsx)(U,{gameState:r,playerName:o,playerId:p.getCurrentUser()?.userId||"",onPlayCard:T,onExtraAction:C}),(0,S.jsx)($,{visible:d,title:"Leave Game",message:"Are you sure you want to leave this game? This action cannot be undone.",onConfirm:async()=>{try{(await p.leaveGame(t)).success&&y.reset({index:0,routes:[{name:"Home"}]})}catch(e){console.error("Error leaving game:",e)}u(!1)},onCancel:()=>u(!1)})]})};var Z=o(4915);const q=["SUECA"],Q=({route:e,navigation:t})=>{const{colors:o}=E();console.log("GameCreationScreen rendered"),console.log("Route params:",e.params);const{playerName:r}=e.params,i=I.getInstance(),[l,c]=(0,n.useState)(q[0]),[d,u]=(0,n.useState)(""),m=s.default.create({container:{flex:1,padding:20},title:{fontSize:24,marginBottom:20},formGroup:{marginBottom:20},label:{marginBottom:10},picker:{padding:10},input:{borderWidth:1,borderColor:o.inputBorder,borderRadius:5,padding:10,color:o.inputText,backgroundColor:o.inputBackground}});return(0,S.jsxs)(a.default,{style:[m.container,{backgroundColor:o.containerBackground}],children:[(0,S.jsx)(h.default,{style:[m.title,{color:o.titleText}],children:"Game Creation"}),(0,S.jsxs)(a.default,{style:m.formGroup,children:[(0,S.jsx)(h.default,{style:[m.label,{color:o.subtitleText}],children:"Select Game Type:"}),(0,S.jsx)(Z.Picker,{selectedValue:l,onValueChange:e=>c(e),style:[m.picker,{backgroundColor:o.pickerBackground}],children:q.map((e=>(0,S.jsx)(Z.Picker.Item,{label:e.replace("_"," "),value:e},e)))})]}),(0,S.jsxs)(a.default,{style:m.formGroup,children:[(0,S.jsx)(h.default,{style:[m.label,{color:o.subtitleText}],children:"Game Name (optional):"}),(0,S.jsx)(g.default,{style:m.input,value:d,onChangeText:u,placeholder:"Enter game name or leave blank for random",placeholderTextColor:o.placeholderText})]}),(0,S.jsx)(G.default,{title:"Create Game",onPress:async()=>{console.log("Creating game"),await i.connect(r),console.log("Connected to socket");const e=d.trim()||Math.random().toString(16).substring(2,10),o=await i.createGame(r,l,e);o.success&&o.gameId&&(console.log("Game created successfully"),t.navigate("Game",{gameId:o.gameId,playerName:r}))},color:o.primaryButton})]})},ee=({route:e,navigation:t})=>{const{colors:o}=E(),{playerName:r}=e.params,i=I.getInstance(),[l,c]=(0,n.useState)(""),d=s.default.create({container:{flex:1,padding:20,justifyContent:"center",backgroundColor:o.containerBackground},input:{borderWidth:1,borderColor:o.inputBorder,padding:10,marginBottom:20,borderRadius:5,backgroundColor:o.inputBackground,color:o.inputText},buttonContainer:{gap:10}});return(0,S.jsxs)(a.default,{style:d.container,children:[(0,S.jsx)(g.default,{style:d.input,placeholder:"Enter game name",onChangeText:e=>c(e),placeholderTextColor:o.placeholderText,value:l}),(0,S.jsx)(G.default,{title:"Join Game",onPress:async()=>{if(l.trim())try{await i.connect(r);const e=await i.joinGame(l,r);e.success?t.navigate("Game",{gameId:l,playerName:r}):"Game not found"===e.error?A.alert("Error","Game not found. Please check the game ID and try again."):"Cannot join a game in progress"===e.error?A.alert("Error","Cannot join a game that is already in progress."):"Game is full"===e.error?A.alert("Error","This game is full and cannot accept more players."):A.alert("Error",e.error||"Failed to join the game.")}catch(e){console.error("Error joining game:",e),A.alert("Connection Error","Failed to connect to the game server. Please try again later.")}else A.alert("Error","Please enter a game ID")},color:o.primaryButton})]})};var te=o(1174);const oe=()=>{const{toggleTheme:e,themeType:t}=E();return(0,S.jsx)(p.default,{style:re.button,onPress:e,accessibilityLabel:"Toggle theme",accessibilityRole:"button",children:(0,S.jsx)(te.default,{name:"light"===t?"moon-outline":"sunny-outline",size:22,color:"light"===t?"#333":"#fff"})})},re=s.default.create({button:{marginRight:8,padding:8}}),ne=(0,u.createStackNavigator)();(0,m.createNativeStackNavigator)();const ae=()=>{const e=ne,{colors:t,themeType:o}=E(),r=(0,n.useRef)(null),[s,u]=(0,n.useState)({name:"Login",params:{}}),[m,g]=(0,n.useState)(!1),h=Object.assign({},c.DefaultTheme,{colors:Object.assign({},c.DefaultTheme.colors,{background:t.appBackground,card:t.containerBackground,text:t.titleText,border:t.inputBorder,primary:t.primaryButton})}),p=async e=>{if(!e)return;let t;console.log("Received deep link:",e);const o=e.match(/cardgame:\/\/game\/([^\/]+)/);o&&(t=o[1]);const n=e.match(/\/game\/([^\/]+)(?:\/|$)/);if(n&&(t=n[1]),t){console.log("Deep link contains game ID:",t);const e=I.getInstance();if(e.isLoggedIn()){const o=r.current;if(o)try{await e.connect(e.getCurrentUser()?.username||"");const r=await e.joinGame(t,e.getCurrentUser()?.username||"");r.success?o.reset({index:0,routes:[{name:"Game",params:{gameId:t,playerName:e.getCurrentUser()?.username}}]}):A.alert("Game Join Failed","Game not found or cannot join"===r.error?"The game you tried to join does not exist or is no longer available.":"Could not join the game.",[{text:"OK",onPress:()=>o.reset({index:0,routes:[{name:"Home"}]})}])}catch(a){console.error("Error joining game:",a),A.alert("Connection Error","Failed to connect to the game server. Please try again later.",[{text:"OK",onPress:()=>o.reset({index:0,routes:[{name:"Home"}]})}])}}else u({name:"Login",params:{gameId:t}})}};return(0,n.useEffect)((()=>{{let e=null;if(e=new URLSearchParams(window.location.search).get("gameId"),e||"undefined"===typeof sessionStorage||(e=sessionStorage.getItem("gameId"),e&&(console.log("Found game ID in sessionStorage:",e),sessionStorage.removeItem("gameId"))),!e){const t=window.location.pathname.match(/\/game\/([^\/]+)(?:\/|$)/);t&&(e=t[1])}if(e&&(console.log("Found game ID:",e),p(e),window.history&&window.history.replaceState)){const e=window.location.pathname;window.history.replaceState({},document.title,e)}}const e=l.default.addEventListener("url",(({url:e})=>{p(e)}));return l.default.getInitialURL().then((e=>{e&&p(e),g(!0)})).catch((e=>{console.error("Error getting initial URL:",e),g(!0)})),()=>{e.remove()}}),[]),(0,n.useEffect)((()=>{const e=I.getInstance(),t=e.getSocket(),o=t=>{console.log("Socket disconnected:",t),"io server disconnect"!==t&&"transport close"!==t||setTimeout((()=>{e.reconnect().catch((e=>{console.error("Failed to reconnect socket after disconnect:",e)}))}),1e3)};return t.on("disconnect",o),()=>{t.off("disconnect",o)}}),[]),m?(0,S.jsxs)(a.default,{style:[ie.container,{backgroundColor:t.appBackground}],children:[(0,S.jsx)(i.default,{backgroundColor:t.appBackground,barStyle:"dark"===o?"light-content":"dark-content"}),(0,S.jsx)(d.NavigationContainer,{theme:h,ref:r,initialState:{routes:[s]},children:(0,S.jsxs)(e.Navigator,{initialRouteName:s.name,screenOptions:{headerShown:!0,headerStyle:{backgroundColor:t.containerBackground,borderBottomColor:t.inputBorder,borderBottomWidth:1},headerTitleStyle:{color:t.titleText},headerTintColor:t.titleText,headerRight:()=>(0,S.jsx)(oe,{})},children:[(0,S.jsx)(e.Screen,{name:"Login",component:P,options:{title:"Sign In",headerLeft:()=>null}}),(0,S.jsx)(e.Screen,{name:"Home",component:R,options:{title:"Home",headerLeft:()=>null}}),(0,S.jsx)(e.Screen,{name:"Game",component:X}),(0,S.jsx)(e.Screen,{name:"GameCreation",component:Q,options:{title:"Create Game"}}),(0,S.jsx)(e.Screen,{name:"JoinGame",component:ee,options:{title:"Join Game"}})]})})]}):null},ie=s.default.create({container:{flex:1}});(0,r.default)((function(){return(0,S.jsx)(v,{children:(0,S.jsx)(ae,{})})}))},9251:(e,t,o)=>{o.r(t),o.d(t,{default:()=>r});const r={}}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,o),a.exports}o.m=e,(()=>{var e=[];o.O=(t,r,n,a)=>{if(!r){var i=1/0;for(d=0;d<e.length;d++){for(var[r,n,a]=e[d],s=!0,l=0;l<r.length;l++)(!1&a||i>=a)&&Object.keys(o.O).every((e=>o.O[e](r[l])))?r.splice(l--,1):(s=!1,a<i&&(i=a));if(s){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[r,n,a]}})(),o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="./",(()=>{var e={792:0};o.O.j=t=>0===e[t];var t=(t,r)=>{var n,a,[i,s,l]=r,c=0;if(i.some((t=>0!==e[t]))){for(n in s)o.o(s,n)&&(o.m[n]=s[n]);if(l)var d=l(o)}for(t&&t(r);c<i.length;c++)a=i[c],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(d)},r=self.webpackChunkweb=self.webpackChunkweb||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=o.O(void 0,[884],(()=>o(9353)));r=o.O(r)})();
//# sourceMappingURL=main.ac995d8a.js.map