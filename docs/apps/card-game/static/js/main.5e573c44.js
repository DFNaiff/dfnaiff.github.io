(()=>{"use strict";var e={4184:(e,t,n)=>{var o=n(2788),r=n(9399),a=n(7686),s=n(3396),i=n(1111),c=n(7904),l=n(3390),d=n(6729),u=n(863),m=n(5346),g=n(5225),h=n(6808);let p=function(e){return e.LOGIN="auth/login",e.LOGOUT="auth/logout",e}({}),f=function(e){return e.CREATE_GAME="main/createGame",e.JOIN_GAME="main/joinGame",e}({}),y=function(e){return e.ADD_AGENT="game/admin/addAgent",e.START_GAME="game/admin/startGame",e.KICK_PLAYER="game/admin/kickPlayer",e.LEAVE_GAME="game/admin/leaveGame",e}({}),b=function(e){return e.PLAY_CARD="game/play/playCard",e.EXTRA_ACTION="game/play/extraAction",e}({}),k=function(e){return e.STATE="broadcast/state",e.GAME_ERROR="broadcast/gameError",e.GAME_ENDED="broadcast/gameEnded",e}({});const x={socketUrl:"https://suecatatau-server-production.up.railway.app",socketPath:"/socket.io/"};class C{currentUser=null;reconnectAttempts=0;MAX_RECONNECT_ATTEMPTS=5;constructor(){this.socket=(0,h.io)(x.socketUrl,{transports:["websocket","polling"],path:x.socketPath,autoConnect:!1,reconnection:!0,reconnectionAttempts:this.MAX_RECONNECT_ATTEMPTS,reconnectionDelay:1e3,timeout:1e4}),console.log("SocketService constructor called, connecting to:",x.socketUrl),this.setupSocketListeners()}setupSocketListeners(){this.socket.on("connect",(()=>{console.log("Socket CONNECTED, ID:",this.socket.id),this.reconnectAttempts=0})),this.socket.on("disconnect",(e=>{console.log("Socket DISCONNECTED, was ID:",this.socket.id,"Reason:",e),"io server disconnect"===e&&this.socket.connect()})),this.socket.on("connect_error",(e=>{console.error("Connection error:",e),this.reconnectAttempts++,this.reconnectAttempts>=this.MAX_RECONNECT_ATTEMPTS&&(console.error("Max reconnection attempts reached"),this.socket.disconnect())})),this.socket.on("reconnect",(e=>{console.log("Socket RECONNECTED, new ID:",this.socket.id,"Attempt:",e)})),this.socket.on("reconnect_attempt",(e=>{console.log("Socket RECONNECTING, attempt:",e)})),this.socket.on(k.STATE,(e=>{console.log("Received state update for socket ID:",this.socket.id)}))}static getInstance(){return C.instance||(C.instance=new C),C.instance}connect(e){return console.log("Connect called, current socket ID:",this.socket.id),new Promise(((e,t)=>{if(this.socket.connected)return console.log("Socket already connected with ID:",this.socket.id),void e();this.socket.connect(),this.socket.on("connect",(()=>{console.log("Connected to server with ID:",this.socket.id),e()})),this.socket.on("connect_error",(e=>{t(e)}))}))}createGame(e,t){return new Promise(((n,o)=>{console.log("Emitting createGame event with playerName:",e,"and gameType:",t);const r=setTimeout((()=>{o(new Error("createGame timeout"))}),5e3);this.socket.emit(f.CREATE_GAME,{playerName:e,gameType:t},(e=>{console.log("Received response from createGame:",e),clearTimeout(r),n(e)})),this.socket.on("error",(e=>{console.error("Socket error:",e),o(e)}))}))}joinGame(e,t){return new Promise(((n,o)=>{console.log("Emitting joinGame event with gameId:",e,"playerName:",t);const r=setTimeout((()=>{o(new Error("joinGame timeout"))}),5e3);this.socket.emit(f.JOIN_GAME,{gameId:e,playerName:t},(e=>{console.log("Received response from joinGame:",e),clearTimeout(r),n(e)})),this.socket.on("error",(e=>{console.error("Socket error:",e),o(e)}))}))}addAgent(e){return new Promise((t=>{this.socket.emit(y.ADD_AGENT,{gameId:e},(e=>{t(e)}))}))}startGame(e){return new Promise((t=>{this.socket.emit(y.START_GAME,{gameId:e},(e=>{t(e)}))}))}playCard(e,t){return new Promise((n=>{this.socket.emit(b.PLAY_CARD,{gameId:e,cardIndex:t},(e=>{n(e)}))}))}onGameState(e){console.log("Setting up game state listener for socket:",{socketId:this.socket.id,userId:this.currentUser?.userId,connected:this.socket.connected}),this.socket.onAny(((e,...t)=>{console.log("Received event:",e,"Socket ID:",this.socket.id,"Args:",t)})),this.socket.on(k.STATE,(t=>{console.log("Received game state for socket:",{socketId:this.socket.id,userId:this.currentUser?.userId,state:t}),e(t)})),this.socket.on("connect",(()=>{console.log("Socket connected:",this.socket.id)})),this.socket.on("disconnect",(()=>{console.log("Socket disconnected")}))}disconnect(){this.socket.disconnect()}login(e){return new Promise((t=>{this.socket.connect(),console.log("Logging in with socket ID:",this.socket.id),this.socket.emit(p.LOGIN,{username:e},(n=>{console.log("Login response received for socket:",{socketId:this.socket.id,response:n}),n.success?this.setCurrentUser(e,n.userId):this.socket.disconnect(),t(n)}))}))}extraAction(e,t,n){return new Promise((o=>{this.socket.emit(b.EXTRA_ACTION,{gameId:e,actionType:t,actionData:n},(e=>{o(e)}))}))}setCurrentUser(e,t){this.currentUser={username:e,userId:t}}getCurrentUser(){return this.currentUser}clearCurrentUser(){this.currentUser=null}async logout(){this.currentUser&&await new Promise((e=>{this.socket.emit(p.LOGOUT,{},(()=>{this.clearCurrentUser(),this.socket.disconnect(),e()}))}))}}var j=n(575);const I=({navigation:e})=>{const[t,n]=(0,r.useState)(""),o=C.getInstance();return(0,j.jsxs)(c.default,{style:S.container,children:[(0,j.jsx)(m.default,{style:S.title,children:"Welcome to Card Game"}),(0,j.jsx)(l.default,{style:S.input,placeholder:"Enter your username",value:t,onChangeText:n,autoFocus:!0}),(0,j.jsx)(d.default,{title:"Login",onPress:async()=>{if(t.trim())try{console.log("Logging in with username:",t);const n=await o.login(t);n.success?(o.setCurrentUser(t,n.userId),console.log("Login successful. Navigating to Home."),e.replace("Home")):(console.log("Login failed:",n.error||"Username already taken"),g.default.alert("Login Failed",n.error||"Username already taken"))}catch(n){g.default.alert("Error","Failed to connect to server")}else g.default.alert("Error","Please enter a username")}})]})},S=u.default.create({container:{flex:1,padding:20,justifyContent:"center"},title:{fontSize:24,textAlign:"center",marginBottom:30},input:{borderWidth:1,borderColor:"#ddd",padding:10,marginBottom:20,borderRadius:5}}),T=({navigation:e})=>{const t=C.getInstance(),n=t.getCurrentUser()?.username;return(0,j.jsxs)(c.default,{style:A.container,children:[(0,j.jsxs)(m.default,{style:A.welcome,children:["Welcome, ",n,"!"]}),(0,j.jsxs)(c.default,{style:A.buttonContainer,children:[(0,j.jsx)(d.default,{title:"Create Game",onPress:()=>{console.log("Creating game"),e.navigate("GameCreation",{playerName:n})}}),(0,j.jsx)(d.default,{title:"Join Game",onPress:()=>{console.log("Joining game"),e.navigate("JoinGame",{playerName:n})}}),(0,j.jsx)(d.default,{title:"Logout",onPress:async()=>{await t.logout(),e.replace("Login")},color:"red"})]})]})},A=u.default.create({container:{flex:1,padding:20,justifyContent:"center"},welcome:{fontSize:24,textAlign:"center",marginBottom:30},buttonContainer:{gap:10}}),v=({gameId:e,onAddAgent:t,onStartGame:n,playerCount:o})=>(0,j.jsxs)(c.default,{style:G.container,children:[(0,j.jsx)(m.default,{style:G.subtitle,children:"Game Setup"}),(0,j.jsxs)(m.default,{children:["Players: ",o]}),(0,j.jsxs)(c.default,{style:G.controls,children:[(0,j.jsx)(d.default,{title:"Add AI Player",onPress:t}),o>=2&&(0,j.jsx)(d.default,{title:"Start Game",onPress:n})]})]}),G=u.default.create({container:{flex:1,padding:20},subtitle:{fontSize:18,fontWeight:"bold",marginBottom:10},controls:{flexDirection:"column",justifyContent:"space-around",marginTop:20}});var E=n(9367),w=n(3717);n(9251);const N=({card:e,onPress:t,disabled:n})=>{const o="hearts"===e.suit||"diamonds"===e.suit;return(0,j.jsxs)(w.default,Object.assign({style:[P.card,n&&P.disabled],className:"card-hover",onPress:t,disabled:n},{style:[P.card,n&&P.disabled,{cursor:"pointer"}]},{children:[(0,j.jsx)(m.default,{style:[P.value,o&&P.redText],children:{11:"J",12:"Q",13:"K",14:"A"}[e.value]||e.value}),(0,j.jsx)(m.default,{style:[P.suit,o&&P.redText],children:{hearts:"\u2665",diamonds:"\u2666",clubs:"\u2663",spades:"\u2660"}[e.suit]})]}))},P=u.default.create({card:{width:60,height:90,backgroundColor:"white",borderRadius:8,borderWidth:1,borderColor:"#ddd",padding:5,margin:2,alignItems:"center",justifyContent:"center"},disabled:{opacity:.5},value:{fontSize:24,color:"black"},suit:{fontSize:32,color:"black"},redText:{color:"red"}}),O=({gameState:e,playerName:t,playerId:n,onPlayCard:o,onExtraAction:r})=>{const a=e.public.currentPlayerIndex,s=e.public.players[a].id===n,i=e.public.gameSpecificData?.isResolvingTrick,l=e.private?.hand||[],u=e.public.gameSpecificData?.currentTrick||[],g=(e.public.gameSpecificData,e.public.gameSpecificData?.canToggle),h=e.public.gameSpecificData?.trumpCard,p=e.public.gameSpecificData?.trumpHolder;return(0,j.jsxs)(c.default,{style:D.container,children:[(0,j.jsx)(m.default,{style:D.status,children:i?"Resolving trick...":s?"Your turn!":`Waiting for ${e.public.players[a].name}`}),(0,j.jsxs)(c.default,{style:D.gameArea,children:[(()=>{if(!h||!p)return null;const t=e.public.players.find((e=>e.id===p))?.name;return(0,j.jsxs)(c.default,{style:D.trumpInfo,children:[(0,j.jsx)(m.default,{style:D.trumpTitle,children:"Trump Card:"}),(0,j.jsx)(N,{card:h}),(0,j.jsxs)(m.default,{style:D.trumpHolder,children:["Held by: ",t]})]})})(),(()=>{const t=e.public.players.findIndex((e=>e.id===n)),o=e.public.players.length,r=e=>{const n=(e-t+o)%o,r=-Math.PI/2-2*n*Math.PI/o;return{position:"absolute",left:"50%",top:"50%",transform:[{translateX:-(160*Math.cos(r))},{translateY:-(160*Math.sin(r))}]}};return(0,j.jsx)(c.default,{style:D.playerTable,children:e.public.players.map(((t,o)=>{const a=e.public.gameSpecificData?.scores?.find((e=>e.playerId===t.id))?.score||0;return(0,j.jsxs)(c.default,{style:[D.playerInfo,r(o)],children:[(0,j.jsx)(m.default,{style:[D.playerNameFixed,t.id===n&&D.currentPlayerName],children:t.name}),(0,j.jsxs)(m.default,{style:D.playerStats,children:["Points: ",a]})]},t.id)}))})})(),(()=>{const t=e.public.players.findIndex((e=>e.id===n)),o=e.public.players.length,r=e=>{const n=(e-t+o)%o,r=-Math.PI/2-2*n*Math.PI/o;return{position:"absolute",left:"50%",top:"50%",transform:[{translateX:-(80*Math.cos(r))},{translateY:-(80*Math.sin(r))},{rotate:`${r+Math.PI/2}rad`}]}};return(0,j.jsx)(c.default,{style:D.trickContainer,children:(0,j.jsx)(c.default,{style:D.trickTable,children:u?.map((({playerId:t,card:n})=>{const o=e.public.players.findIndex((e=>e.id===t));return(0,j.jsx)(c.default,{style:[D.trickCardContainer,r(o)],children:(0,j.jsx)(N,{card:n})},t)}))})})})()]}),(0,j.jsxs)(c.default,{style:D.handContainer,children:[(0,j.jsx)(m.default,{style:D.subtitle,children:"Your Hand:"}),(0,j.jsx)(E.default,{horizontal:!0,style:D.hand,children:l.map(((e,t)=>(0,j.jsx)(N,{card:e,onPress:()=>s&&o(t)},t)))}),s&&g&&r?(0,j.jsx)(c.default,{style:D.extraActionContainer,children:(0,j.jsx)(d.default,{title:`Toggle ${e.public.gameSpecificData?.isHighWins?"High":"Low"} Wins`,onPress:()=>r("TOGGLE_WIN_CONDITION",{})})}):null]})]})},D=u.default.create({container:{flex:1},status:{fontSize:16,marginBottom:20},subtitle:{fontSize:18,fontWeight:"bold",marginBottom:10},trickContainer:{position:"absolute",width:"100%",height:"100%",alignItems:"center",justifyContent:"center"},trickTable:{width:200,height:200,position:"relative",alignItems:"center",justifyContent:"center"},tableBackground:{position:"absolute",width:"100%",height:"100%",borderRadius:100,backgroundColor:"#1B5E20",borderWidth:4,borderColor:"#4A3211"},trickCardContainer:{position:"absolute",alignItems:"center",width:70,height:100},playerName:{fontSize:12,marginTop:5,textAlign:"center",transform:[{rotate:"0deg"}]},handContainer:{marginTop:"auto"},hand:{flexGrow:0,height:100,marginBottom:10},extraActionContainer:{marginTop:10,marginBottom:20},gameArea:{flex:1,position:"relative",marginVertical:20},playerTable:{width:400,height:400,position:"relative",alignSelf:"center"},playerInfo:{position:"absolute",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0.9)",padding:8,borderRadius:8,minWidth:100,borderWidth:1,borderColor:"#ccc"},playerNameFixed:{fontSize:14,fontWeight:"bold",marginBottom:4},currentPlayerName:{color:"#2196F3"},playerStats:{fontSize:12,color:"#666"},trumpInfo:{position:"absolute",top:10,right:10,alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0.9)",padding:8,borderRadius:8,borderWidth:1,borderColor:"#ccc"},trumpTitle:{fontSize:14,fontWeight:"bold",marginBottom:4},trumpHolder:{fontSize:12,color:"#666",marginTop:4}}),R=({route:e})=>{const{gameId:t,playerName:n}=e.params,[o,a]=(0,r.useState)(null),[s,i]=(0,r.useState)({mode:"management",isCurrentPlayer:!1}),l=C.getInstance();console.log("GameScreen mounted with gameId:",t,"and playerName:",n),(0,r.useEffect)((()=>(console.log("useEffect called"),l.onGameState((e=>{console.log("Game state received:",e),a(e),i((t=>Object.assign({},t,{mode:"PLAYING"===e.public.phase?"playing":"management",isCurrentPlayer:e.public.players[e.public.currentPlayerIndex]?.name===n})))})),()=>{l.disconnect()})),[]);return o?(0,j.jsxs)(c.default,{style:_.container,children:[(0,j.jsxs)(m.default,{style:_.title,children:["Game Room: ",t]}),"management"===s.mode?(0,j.jsx)(v,{gameId:t,onAddAgent:()=>{l.addAgent(t)},onStartGame:()=>{l.startGame(t)},playerCount:o.public.players.length}):(0,j.jsx)(O,{gameState:o,playerName:n,playerId:l.getCurrentUser()?.userId||"",onPlayCard:e=>{l.playCard(t,e)},onExtraAction:(e,n)=>{l.extraAction(t,e,n)}})]}):(0,j.jsx)(m.default,{children:"Loading..."})},_=u.default.create({container:{flex:1,padding:20},title:{fontSize:24,fontWeight:"bold",marginBottom:20},subtitle:{fontSize:18,fontWeight:"bold",marginBottom:10},controls:{flexDirection:"row",justifyContent:"space-around",marginBottom:20},status:{fontSize:16,marginBottom:20},trickContainer:{marginBottom:20},trick:{flexGrow:0,height:100},handContainer:{marginTop:"auto"},hand:{flexGrow:0,height:100},scoreboard:{marginTop:20}});var M=n(3883);const L=["HIGH_CARD","HIGH_LOW_CARD","SUECA"],U=({route:e,navigation:t})=>{console.log("GameCreationScreen rendered"),console.log("Route params:",e.params);const{playerName:n}=e.params,o=C.getInstance(),[a,s]=(0,r.useState)("HIGH_CARD");return(0,j.jsxs)(c.default,{style:{padding:20},children:[(0,j.jsx)(m.default,{style:{fontSize:24,marginBottom:20},children:"Game Creation"}),(0,j.jsxs)(c.default,{style:{marginBottom:20},children:[(0,j.jsx)(m.default,{style:{marginBottom:10},children:"Select Game Type:"}),(0,j.jsx)(M.Picker,{selectedValue:a,onValueChange:e=>s(e),style:{backgroundColor:"#f0f0f0",padding:10},children:L.map((e=>(0,j.jsx)(M.Picker.Item,{label:e.replace("_"," "),value:e},e)))})]}),(0,j.jsx)(d.default,{title:"Create Game",onPress:async()=>{console.log("Creating game"),await o.connect(n),console.log("Connected to socket");const e=await o.createGame(n,a);e.success&&e.gameId&&(console.log("Game created successfully"),t.navigate("Game",{gameId:e.gameId,playerName:n}))}})]})},B=({route:e,navigation:t})=>{const{playerName:n}=e.params,o=C.getInstance(),[a,s]=(0,r.useState)("");return(0,j.jsxs)(c.default,{style:W.container,children:[(0,j.jsx)(l.default,{style:W.input,placeholder:"Enter game identifier",onChangeText:e=>s(e)}),(0,j.jsx)(d.default,{title:"Join Game",onPress:async()=>{await o.connect(n),await o.joinGame(a,n),t.navigate("Game",{gameId:a,playerName:n})}})]})},W=u.default.create({container:{flex:1,padding:20,justifyContent:"center"},input:{borderWidth:1,borderColor:"#ddd",padding:10,marginBottom:20,borderRadius:5},buttonContainer:{gap:10}}),z=(0,i.createStackNavigator)();(0,s.createNativeStackNavigator)();(0,o.default)((function(){const e=z;return(0,j.jsx)(a.NavigationContainer,{children:(0,j.jsxs)(e.Navigator,{initialRouteName:"Login",screenOptions:{headerShown:!0},children:[(0,j.jsx)(e.Screen,{name:"Login",component:I,options:{headerShown:!1}}),(0,j.jsx)(e.Screen,{name:"Home",component:T}),(0,j.jsx)(e.Screen,{name:"Game",component:R}),(0,j.jsx)(e.Screen,{name:"GameCreation",component:U}),(0,j.jsx)(e.Screen,{name:"JoinGame",component:B})]})})}))},9251:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});const o={}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.m=e,(()=>{var e=[];n.O=(t,o,r,a)=>{if(!o){var s=1/0;for(d=0;d<e.length;d++){for(var[o,r,a]=e[d],i=!0,c=0;c<o.length;c++)(!1&a||s>=a)&&Object.keys(n.O).every((e=>n.O[e](o[c])))?o.splice(c--,1):(i=!1,a<s&&(s=a));if(i){e.splice(d--,1);var l=r();void 0!==l&&(t=l)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[o,r,a]}})(),n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};n.O.j=t=>0===e[t];var t=(t,o)=>{var r,a,[s,i,c]=o,l=0;if(s.some((t=>0!==e[t]))){for(r in i)n.o(i,r)&&(n.m[r]=i[r]);if(c)var d=c(n)}for(t&&t(o);l<s.length;l++)a=s[l],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(d)},o=self.webpackChunkweb=self.webpackChunkweb||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=n.O(void 0,[191],(()=>n(4184)));o=n.O(o)})();
//# sourceMappingURL=main.5e573c44.js.map