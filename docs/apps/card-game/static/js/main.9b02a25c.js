(()=>{"use strict";var e={6536:(e,t,r)=>{var o=r(7036),a=r(9399),n=r(7904),i=r(784),l=r(863),s=r(5489),c=r(277),d=r(1111),u=r(3396),m=r(3390),g=r(6729),h=r(5346),p=r(5225),f=r(6808);let y=function(e){return e.LOGIN="auth/login",e.LOGOUT="auth/logout",e.HEARTBEAT="auth:heartbeat",e}({}),b=function(e){return e.CREATE_GAME="main/createGame",e.JOIN_GAME="main/joinGame",e.LEAVE_GAME="main/leaveGame",e}({}),x=function(e){return e.ADD_AGENT="game/admin/addAgent",e.START_GAME="game/admin/startGame",e.KICK_PLAYER="game/admin/kickPlayer",e.LEAVE_GAME="game/admin/leaveGame",e}({}),T=function(e){return e.PLAY_CARD="game/play/playCard",e.EXTRA_ACTION="game/play/extraAction",e}({}),k=function(e){return e.STATE="broadcast/state",e.GAME_ERROR="broadcast/gameError",e.GAME_ENDED="broadcast/gameEnded",e.GAME_DELETED="broadcast/gameDeleted",e.NOT_IN_GAME="broadcast/notInGame",e}({});const C={socketUrl:"https://suecatatau-server-production.up.railway.app",socketPath:"/socket.io/"};class I{currentUser=null;reconnectAttempts=0;MAX_RECONNECT_ATTEMPTS=5;heartbeatInterval=null;HEARTBEAT_INTERVAL=6e4;eventHandlers=new Map;constructor(){this.socket=(0,f.io)(C.socketUrl,{transports:["websocket","polling"],path:C.socketPath,autoConnect:!1,reconnection:!0,reconnectionAttempts:this.MAX_RECONNECT_ATTEMPTS,reconnectionDelay:1e3,timeout:1e4}),console.log("SocketService constructor called, connecting to:",C.socketUrl),this.setupSocketListeners()}setupSocketListeners(){this.socket.on("connect",(()=>{console.log("Socket CONNECTED, ID:",this.socket.id),this.reconnectAttempts=0})),this.socket.on("disconnect",(e=>{console.log("Socket DISCONNECTED, was ID:",this.socket.id,"Reason:",e),"io server disconnect"===e&&this.socket.connect()})),this.socket.on("connect_error",(e=>{console.error("Connection error:",e),this.reconnectAttempts++,this.reconnectAttempts>=this.MAX_RECONNECT_ATTEMPTS&&(console.error("Max reconnection attempts reached"),this.socket.disconnect())})),this.socket.on("reconnect",(e=>{console.log("Socket RECONNECTED, new ID:",this.socket.id,"Attempt:",e)})),this.socket.on("reconnect_attempt",(e=>{console.log("Socket RECONNECTING, attempt:",e)})),this.socket.on(k.STATE,(e=>{console.log("Received state update for socket ID:",this.socket.id)})),this.socket.on(k.GAME_DELETED,(e=>{console.log("Received game deleted event for socket ID:",this.socket.id,"Game ID:",e.gameId)})),this.socket.on(k.NOT_IN_GAME,(e=>{console.log("Received not in game event for socket ID:",this.socket.id,"Game ID:",e.gameId,"Player ID:",e.playerId),this.triggerEvent(k.NOT_IN_GAME,e)})),this.socket.on("forceDisconnect",(e=>{console.log("[Client Force Disconnect]",{socketId:this.socket.id,userId:this.currentUser?.userId,reason:e.reason,timestamp:(new Date).toISOString()}),this.clearHeartbeat(),this.clearCurrentUser(),this.socket.disconnect()}))}static getInstance(){return I.instance||(I.instance=new I),I.instance}connect(e){return console.log("Connect called, current socket ID:",this.socket.id),new Promise(((e,t)=>{if(this.socket.connected)return console.log("Socket already connected with ID:",this.socket.id),void e();this.socket.connect(),this.socket.on("connect",(()=>{console.log("Connected to server with ID:",this.socket.id),e()})),this.socket.on("connect_error",(e=>{t(e)}))}))}createGame(e,t,r){return new Promise(((o,a)=>{console.log("Emitting createGame event with playerName:",e,"and gameType:",t);const n=setTimeout((()=>{a(new Error("createGame timeout"))}),5e3);this.socket.emit(b.CREATE_GAME,{playerName:e,gameType:t,gameName:r},(e=>{console.log("Received response from createGame:",e),clearTimeout(n),o(e)})),this.socket.on("error",(e=>{console.error("Socket error:",e),a(e)}))}))}joinGame(e,t){return new Promise(((r,o)=>{console.log("Emitting joinGame event with gameId:",e,"playerName:",t);const a=setTimeout((()=>{o(new Error("joinGame timeout"))}),5e3);this.socket.emit(b.JOIN_GAME,{gameId:e,playerName:t},(e=>{console.log("Received response from joinGame:",e),clearTimeout(a),r(e)})),this.socket.on("error",(e=>{console.error("Socket error:",e),o(e)}))}))}addAgent(e){return new Promise((t=>{this.socket.emit(x.ADD_AGENT,{gameId:e},(e=>{t(e)}))}))}startGame(e){return new Promise((t=>{this.socket.emit(x.START_GAME,{gameId:e},(e=>{t(e)}))}))}playCard(e,t){return new Promise((r=>{this.socket.emit(T.PLAY_CARD,{gameId:e,cardIndex:t},(e=>{r(e)}))}))}onGameState(e){console.log("Setting up game state listener for socket:",{socketId:this.socket.id,userId:this.currentUser?.userId,connected:this.socket.connected}),this.socket.onAny(((e,...t)=>{console.log("Received event:",e,"Socket ID:",this.socket.id,"Args:",t)})),this.socket.on(k.STATE,(t=>{console.log("Received game state for socket:",{socketId:this.socket.id,userId:this.currentUser?.userId,state:t}),e(t)})),this.socket.on("connect",(()=>{console.log("Socket connected:",this.socket.id)})),this.socket.on("disconnect",(()=>{console.log("Socket disconnected")}))}disconnect(){this.socket.disconnect()}setupHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),console.log("[Client Heartbeat] Cleared existing heartbeat interval")),console.log("[Client Heartbeat] Setting up new heartbeat interval"),this.heartbeatInterval=setInterval((()=>{this.socket.connected&&this.currentUser?(console.log("[Client Heartbeat] Sending heartbeat:",{socketId:this.socket.id,userId:this.currentUser.userId,timestamp:(new Date).toISOString()}),this.socket.emit(y.HEARTBEAT,{},(e=>{console.log("[Client Heartbeat] Received response:",{socketId:this.socket.id,userId:this.currentUser?.userId,success:e.success,timestamp:(new Date).toISOString()}),e.success||(console.warn("[Client Heartbeat] Failed, initiating logout"),this.logout())}))):console.log("[Client Heartbeat] Skipped: Socket disconnected or no user",{connected:this.socket.connected,hasUser:!!this.currentUser})}),this.HEARTBEAT_INTERVAL)}clearHeartbeat(){this.heartbeatInterval&&(console.log("[Client Heartbeat] Clearing heartbeat interval"),clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}login(e){return new Promise((t=>{this.socket.connect(),console.log("Logging in with socket ID:",this.socket.id),this.socket.emit(y.LOGIN,{username:e},(r=>{console.log("Login response received for socket:",{socketId:this.socket.id,response:r}),r.success?(this.setCurrentUser(e,r.userId),this.setupHeartbeat()):this.socket.disconnect(),t(r)}))}))}extraAction(e,t,r){return new Promise((o=>{this.socket.emit(T.EXTRA_ACTION,{gameId:e,actionType:t,actionData:r},(e=>{o(e)}))}))}setCurrentUser(e,t){this.currentUser={username:e,userId:t}}getCurrentUser(){return this.currentUser}clearCurrentUser(){this.currentUser=null}async logout(){this.clearHeartbeat(),this.currentUser&&await new Promise((e=>{this.socket.emit(y.LOGOUT,{},(()=>{this.clearCurrentUser(),this.socket.disconnect(),e()}))}))}leaveGame(e){return new Promise(((t,r)=>{console.log("Emitting leaveGame event with gameId:",e);const o=setTimeout((()=>{r(new Error("leaveGame timeout"))}),5e3);this.socket.emit(b.LEAVE_GAME,{gameId:e},(e=>{console.log("Received response from leaveGame:",e),clearTimeout(o),t(e)})),this.socket.on("error",(e=>{console.error("Socket error:",e),r(e)}))}))}kickPlayer(e,t){this.socket.emit(x.KICK_PLAYER,{gameId:e,playerId:t})}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,[]),this.eventHandlers.get(e)?.push(t)}off(e,t){if(!this.eventHandlers.has(e))return;const r=this.eventHandlers.get(e)||[],o=r.indexOf(t);-1!==o&&r.splice(o,1)}triggerEvent(e,...t){(this.eventHandlers.get(e)||[]).forEach((e=>e(...t)))}}var S=r(575);const B={cardBackground:"white",cardBorder:"#ddd",cardTextBlack:"black",cardTextRed:"red",dialogOverlay:"rgba(0, 0, 0, 0.5)",dialogBackground:"white",dialogCancelButton:"#666",dialogConfirmButton:"#d32f2f",dialogButtonText:"white",leaveButtonBackground:"#d32f2f",leaveButtonText:"white",playerInfoBackground:"rgba(255, 255, 255, 0.9)",playerInfoBorder:"#ccc",currentPlayerText:"#4CAF50",playerStatsText:"#666",trumpInfoBackground:"rgba(255, 255, 255, 0.9)",trumpInfoBorder:"#ccc",teamScoreCardBackground:"rgba(255, 255, 255, 0.6)",teamScoreCardBorder:"rgba(0, 0, 0, 0.1)",inputBorder:"#ddd",inputBackground:"white",inputText:"black",placeholderText:"gray",tableFelt:"#1B5E20",tableEdge:"#4A3211",statusText:"#000000",subtitleText:"#000000",playerTeamBackground:"rgba(220, 242, 220, 0.7)",playerTeamBorder:"rgba(76, 175, 80, 0.3)",teamScoreText:"#333",playerTeamScoreText:"#1B5E20",welcomeText:"#000000",logoutButton:"#d32f2f",primaryButton:"#2196f3",primaryButtonText:"white",appBackground:"#e8f5e9",containerBackground:"#e8f5e9",pickerBackground:"#e0f2f1",titleText:"#000000"},j={cardBackground:"#2c2c2c",cardBorder:"#444",cardTextBlack:"#e0e0e0",cardTextRed:"#ff6b6b",dialogOverlay:"rgba(0, 0, 0, 0.7)",dialogBackground:"#2c2c2c",dialogCancelButton:"#555",dialogConfirmButton:"#b71c1c",dialogButtonText:"#e0e0e0",leaveButtonBackground:"#b71c1c",leaveButtonText:"#e0e0e0",playerInfoBackground:"rgba(40, 40, 40, 0.9)",playerInfoBorder:"#444",currentPlayerText:"#66bb6a",playerStatsText:"#aaa",trumpInfoBackground:"rgba(40, 40, 40, 0.9)",trumpInfoBorder:"#444",teamScoreCardBackground:"rgba(40, 40, 40, 0.6)",teamScoreCardBorder:"rgba(255, 255, 255, 0.1)",inputBorder:"#444",inputBackground:"#222",inputText:"#e0e0e0",placeholderText:"#aaa",tableFelt:"#0c3912",tableEdge:"#2A1901",statusText:"#e0e0e0",subtitleText:"#e0e0e0",playerTeamBackground:"rgba(40, 97, 40, 0.7)",playerTeamBorder:"rgba(76, 175, 80, 0.3)",teamScoreText:"#e0e0e0",playerTeamScoreText:"#66bb6a",welcomeText:"#e0e0e0",logoutButton:"#b71c1c",primaryButton:"#1565c0",primaryButtonText:"#e0e0e0",appBackground:"#121212",containerBackground:"#121212",pickerBackground:"#333",titleText:"#e0e0e0"},v=(0,a.createContext)({themeType:"light",colors:B,setThemeType:()=>{},toggleTheme:()=>{}}),A=({children:e})=>{const[t,r]=(0,a.useState)("light"),o="light"===t?B:j;return(0,S.jsx)(v.Provider,{value:{themeType:t,colors:o,setThemeType:r,toggleTheme:()=>{r((e=>"light"===e?"dark":"light"))}},children:e})},E=()=>{const e=(0,a.useContext)(v);if(void 0===e)throw new Error("useTheme must be used within a ThemeProvider");return e},w=B,G=({navigation:e})=>{const[t,r]=(0,a.useState)(""),o=I.getInstance(),{colors:i}=E(),s=l.default.create({container:{flex:1,padding:20,justifyContent:"center",backgroundColor:i.containerBackground},title:{fontSize:24,textAlign:"center",marginBottom:30,color:i.titleText},input:{borderWidth:1,borderColor:i.inputBorder,backgroundColor:i.inputBackground,padding:10,marginBottom:20,borderRadius:5,color:i.titleText},buttonContainer:{marginTop:10}});return(0,S.jsxs)(n.default,{style:s.container,children:[(0,S.jsx)(h.default,{style:s.title,children:"Enter Your Username"}),(0,S.jsx)(m.default,{style:s.input,onChangeText:r,value:t,placeholder:"Username",placeholderTextColor:i.playerStatsText,autoCapitalize:"none",autoCorrect:!1}),(0,S.jsx)(n.default,{style:s.buttonContainer,children:(0,S.jsx)(g.default,{title:"Login",onPress:async()=>{if(t.trim())try{console.log("Logging in with username:",t);const r=await o.login(t);r.success?(o.setCurrentUser(t,r.userId),console.log("Login successful. Navigating to Home."),e.replace("Home")):(console.log("Login failed:",r.error||"Username already taken"),p.default.alert("Login Failed",r.error||"Username already taken"))}catch(r){p.default.alert("Error","Failed to connect to server")}else p.default.alert("Error","Please enter a username")},color:i.primaryButton})})]})},P=({navigation:e})=>{const{colors:t,toggleTheme:r,themeType:o}=E(),a=I.getInstance(),i=a.getCurrentUser()?.username,s=l.default.create({container:{flex:1,padding:20,justifyContent:"center"},welcome:{fontSize:24,textAlign:"center",marginBottom:30,color:t.welcomeText},buttonContainer:{gap:10}});return(0,S.jsxs)(n.default,{style:[s.container,{backgroundColor:t.containerBackground}],children:[(0,S.jsxs)(h.default,{style:s.welcome,children:["Welcome, ",i,"!"]}),(0,S.jsxs)(n.default,{style:s.buttonContainer,children:[(0,S.jsx)(g.default,{title:"Create Game",onPress:()=>{console.log("Creating game"),e.navigate("GameCreation",{playerName:i})},color:t.primaryButton}),(0,S.jsx)(g.default,{title:"Join Game",onPress:()=>{console.log("Joining game"),e.navigate("JoinGame",{playerName:i})},color:t.primaryButton}),(0,S.jsx)(g.default,{title:"Logout",onPress:async()=>{await a.logout(),console.log("Logging out"),e.replace("Login")},color:t.logoutButton})]})]})};var N=r(5318),R=r(9367);const _=({gameId:e,onAddAgent:t,onStartGame:r,playerCount:o,players:a,isOwner:i,onKickPlayer:s,gameCharacteristics:c})=>{const{colors:d}=E(),u=l.default.create({container:{flex:1,padding:20},subtitle:{fontSize:18,fontWeight:"bold",marginBottom:10},controls:{flexDirection:"column",justifyContent:"space-around",marginTop:20},playerListContainer:{marginTop:10,marginBottom:10,height:160,borderWidth:1,borderColor:"#ddd",borderRadius:5},playerList:{flex:1},playerRow:{flexDirection:"row",justifyContent:"space-between",paddingVertical:8,paddingHorizontal:10,borderBottomWidth:1,borderBottomColor:"#eee"},playerName:{fontSize:16},kickButton:{color:"red",fontSize:18,fontWeight:"bold",padding:5},buttonSpacer:{marginTop:10}}),m=o>=(c?.minPlayers||2);return(0,S.jsxs)(n.default,{style:u.container,children:[(0,S.jsx)(h.default,{style:[u.subtitle,{color:d.titleText}],children:"Game Setup"}),(0,S.jsxs)(h.default,{style:{color:d.statusText},children:["Players: ",o," (Min: ",c?.minPlayers||2,")"]}),(0,S.jsx)(n.default,{style:u.playerListContainer,children:(0,S.jsx)(R.default,{style:u.playerList,children:a.map((e=>(0,S.jsxs)(n.default,{style:u.playerRow,children:[(0,S.jsxs)(h.default,{style:[u.playerName,{color:d.statusText}],children:[e.name," ",e.isAgent?"(AI)":""," ",e.isOwner?"(Owner)":""]}),i&&!e.isOwner&&(0,S.jsx)(h.default,{style:u.kickButton,onPress:()=>s(e.id),children:"\u2715"})]},e.id)))})}),(0,S.jsx)(n.default,{style:u.controls,children:i&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(g.default,{title:"Add AI Player",onPress:t}),m&&(0,S.jsx)(n.default,{style:u.buttonSpacer,children:(0,S.jsx)(g.default,{title:"Start Game",onPress:r})})]})})]})};var D=r(3296),O=r(3717);r(9251);const L=({card:e,onPress:t,disabled:r})=>{const o="hearts"===e.suit||"diamonds"===e.suit;return(0,S.jsxs)(O.default,Object.assign({style:[H.card,r&&H.disabled],className:"card-hover",onPress:t,disabled:r},{style:[H.card,r&&H.disabled,{cursor:"pointer"}]},{children:[(0,S.jsx)(h.default,{style:[H.value,o&&H.redText],children:{11:"J",12:"Q",13:"K",14:"A"}[e.value]||e.value}),(0,S.jsx)(h.default,{style:[H.suit,o&&H.redText],children:{hearts:"\u2665",diamonds:"\u2666",clubs:"\u2663",spades:"\u2660"}[e.suit]})]}))},H=l.default.create({card:{width:60,height:90,backgroundColor:w.cardBackground,borderRadius:8,borderWidth:1,borderColor:w.cardBorder,padding:5,margin:2,alignItems:"center",justifyContent:"center"},disabled:{opacity:.5},value:{fontSize:24,color:w.cardTextBlack},suit:{fontSize:32,color:w.cardTextBlack},redText:{color:w.cardTextRed}}),M={TABLE_SIZE:280,TABLE_MEMBERS_EXPANSION_FACTOR:2.5,CARD_RADIUS_FACTOR:.5,PLAYER_RADIUS_FACTOR:.5,MIN_GAME_AREA_HEIGHT:350,CARD_SIZE:{width:60,height:85},PLAYER_INFO_MIN_WIDTH:80},W=({gameState:e,playerName:t,playerId:r,onPlayCard:o,onExtraAction:a})=>{const{colors:i}=E(),s=l.default.create({container:{flex:1,position:"relative",padding:10,width:"100%",alignSelf:"center",display:"flex",flexDirection:"column"},headerRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:10},status:{fontSize:16,flex:1,color:i.statusText},subtitle:{fontSize:18,fontWeight:"bold",marginBottom:5,color:i.subtitleText},trickContainer:{position:"absolute",width:"100%",height:"100%",alignItems:"center",justifyContent:"center",zIndex:1},trickTable:{position:"relative",alignItems:"center",justifyContent:"center"},tableBackground:{position:"absolute",width:"100%",height:"100%",borderRadius:1e3,backgroundColor:i.tableFelt,borderWidth:4,borderColor:i.tableEdge},cardPositioner:{position:"absolute",width:0,height:0,alignItems:"center",justifyContent:"center"},trickCardContainer:{position:"absolute",alignItems:"center"},handContainer:{width:"100%",marginTop:5,marginBottom:10,flexShrink:0},handWrapper:{width:"100%",height:100},handContent:{alignItems:"center",paddingHorizontal:5},hand:{flexGrow:0},extraActionContainer:{marginTop:10,marginBottom:10},gameArea:{flex:1,position:"relative",marginVertical:10},playAreaContainer:{width:"100%",height:"100%",position:"relative",alignItems:"center",justifyContent:"center"},playerTable:{position:"absolute",width:0,height:0,alignItems:"center",justifyContent:"center",zIndex:2},playerInfo:{position:"absolute",alignItems:"center",backgroundColor:i.playerInfoBackground,padding:8,borderRadius:8,minWidth:80,borderWidth:1,borderColor:i.playerInfoBorder},playerNameFixed:{fontSize:12,fontWeight:"bold",marginBottom:2},currentPlayerName:{color:i.currentPlayerText,fontWeight:"bold"},playerStats:{fontSize:10,color:i.playerStatsText},trumpInfo:{position:"absolute",top:5,right:5,alignItems:"center",backgroundColor:i.trumpInfoBackground,padding:5,borderRadius:6,borderWidth:1,borderColor:i.trumpInfoBorder,zIndex:10},trumpTitle:{fontSize:14,fontWeight:"bold",marginBottom:4},trumpHolder:{fontSize:12,color:i.playerStatsText,marginTop:4},teamScoreContainer:{flexDirection:"row",justifyContent:"flex-end",gap:5},teamScoreCard:{backgroundColor:i.teamScoreCardBackground,borderRadius:4,paddingVertical:3,paddingHorizontal:6,minWidth:50,alignItems:"center",borderWidth:1,borderColor:i.teamScoreCardBorder},playerTeamCard:{backgroundColor:i.playerTeamBackground,borderColor:i.playerTeamBorder},teamName:{fontSize:12,fontWeight:"500",textAlign:"center"},teamScore:{fontSize:14,fontWeight:"bold",color:i.teamScoreText},playerTeamScore:{color:i.playerTeamScoreText}}),c=e.public.currentPlayerIndex,d=e.public.players[c].id===r,u=e.public.gameSpecificData?.isResolvingTrick,m=e.private?.hand||[],p=e.public.gameSpecificData?.currentTrick||[],f=(e.public.gameSpecificData,e.public.gameSpecificData?.canToggle),y=e.public.gameSpecificData?.trumpCard,b=e.public.gameSpecificData?.trumpHolder,x=e.public.gameSpecificData?.teams||[],T=e.public.gameSpecificData?.gamePoints||[],k=x.findIndex((e=>e.includes(r))),C=D.default.get("window").width,I=D.default.get("window").height,B=U(C,I),j=M;return(0,S.jsxs)(n.default,{style:s.container,children:[(0,S.jsxs)(n.default,{style:s.headerRow,children:[(0,S.jsx)(h.default,{style:s.status,children:u?"Resolving trick...":d?"Your turn!":`Waiting for ${e.public.players[c].name}`}),x&&0!==x.length&&T?(0,S.jsx)(n.default,{style:s.teamScoreContainer,children:x.map(((e,t)=>{const r=T[t]||0,o=t===k;return(0,S.jsxs)(n.default,{style:[s.teamScoreCard,o&&s.playerTeamCard],children:[(0,S.jsxs)(h.default,{style:s.teamName,children:["Team ",t+1,o?" \u2605":""]}),(0,S.jsx)(h.default,{style:[s.teamScore,o&&s.playerTeamScore],children:r})]},`team-${t}`)}))}):null]}),(0,S.jsx)(n.default,{style:[s.gameArea,B.gameArea,{minHeight:j.MIN_GAME_AREA_HEIGHT}],children:(0,S.jsxs)(n.default,{style:s.playAreaContainer,children:[(()=>{if(!y||!b)return null;const t=e.public.players.find((e=>e.id===b))?.name;return(0,S.jsxs)(n.default,{style:s.trumpInfo,children:[(0,S.jsx)(h.default,{style:s.trumpTitle,children:"Trump Card:"}),(0,S.jsx)(L,{card:y}),(0,S.jsxs)(h.default,{style:s.trumpHolder,children:["Held by: ",t]})]})})(),(()=>{const t=e.public.players.findIndex((e=>e.id===r)),o=e.public.players.length,a=j.TABLE_SIZE/2*j.CARD_RADIUS_FACTOR,i=e=>{const r=(e-t+o)%o,n=-Math.PI/2-2*r*Math.PI/o;return{position:"absolute",transform:[{translateX:-a*Math.cos(n)},{translateY:-a*Math.sin(n)},{rotate:`${n+Math.PI/2}rad`}]}};return(0,S.jsx)(n.default,{style:s.trickContainer,children:(0,S.jsxs)(n.default,{style:[s.trickTable,{width:j.TABLE_SIZE,height:j.TABLE_SIZE}],children:[(0,S.jsx)(n.default,{style:s.tableBackground}),(0,S.jsx)(n.default,{style:s.cardPositioner,children:p?.map((({playerId:t,card:r})=>{const o=e.public.players.findIndex((e=>e.id===t));return(0,S.jsx)(n.default,{style:[s.trickCardContainer,i(o),{width:j.CARD_SIZE.width,height:j.CARD_SIZE.height}],children:(0,S.jsx)(L,{card:r})},t)}))})]})})})(),(()=>{const t=e.public.players.findIndex((e=>e.id===r)),o=e.public.players.length,a=j.TABLE_SIZE/2*j.PLAYER_RADIUS_FACTOR*j.TABLE_MEMBERS_EXPANSION_FACTOR,i=e=>{const r=(e-t+o)%o,n=-Math.PI/2-2*r*Math.PI/o;return{position:"absolute",transform:[{translateX:-a*Math.cos(n)},{translateY:-a*Math.sin(n)}]}};return(0,S.jsx)(n.default,{style:s.playerTable,children:e.public.players.map(((t,o)=>{const a=e.public.gameSpecificData?.scores?.find((e=>e.playerId===t.id))?.score||0;return(0,S.jsxs)(n.default,{style:[s.playerInfo,i(o),{minWidth:j.PLAYER_INFO_MIN_WIDTH}],children:[(0,S.jsx)(h.default,{style:[s.playerNameFixed,t.id===r&&s.currentPlayerName],children:t.name}),(0,S.jsxs)(h.default,{style:s.playerStats,children:["Points: ",a]})]},t.id)}))})})()]})}),(0,S.jsxs)(n.default,{style:s.handContainer,children:[(0,S.jsx)(h.default,{style:s.subtitle,children:"Your Hand:"}),(0,S.jsx)(n.default,{style:s.handWrapper,children:(0,S.jsx)(R.default,{horizontal:!0,contentContainerStyle:s.handContent,children:m.map(((e,t)=>(0,S.jsx)(L,{card:e,onPress:()=>d&&o(t)},t)))})}),d&&f&&a?(0,S.jsx)(n.default,{style:s.extraActionContainer,children:(0,S.jsx)(g.default,{title:`Toggle ${e.public.gameSpecificData?.isHighWins?"High":"Low"} Wins`,onPress:()=>a("TOGGLE_WIN_CONDITION",{})})}):null]})]})},U=(e,t)=>({gameArea:{maxHeight:.6*t},playerTable:e<=768?{maxWidth:350,maxHeight:350}:{maxWidth:450,maxHeight:450}}),z=({teams:e,gamePoints:t,playerId:r,players:o,gamePointsReversed:a})=>{const{colors:i}=E(),s=l.default.create({container:{flex:1,padding:20},title:{fontSize:24,fontWeight:"bold",textAlign:"center",marginBottom:10},subtitle:{fontSize:18,textAlign:"center",marginBottom:20},scoreList:{flex:1},teamRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:15,backgroundColor:i.teamScoreCardBackground,borderRadius:8,marginBottom:10,borderWidth:1,borderColor:i.teamScoreCardBorder},playerTeamRow:{backgroundColor:i.playerTeamBackground,borderColor:i.playerTeamBorder},winnerRow:{borderWidth:2,borderColor:"gold"},rankAndTeam:{flexDirection:"row",flex:1,alignItems:"flex-start"},rank:{fontSize:18,fontWeight:"bold",marginRight:10,width:25},teamMembers:{flex:1},teamTitle:{fontSize:16,fontWeight:"bold",marginBottom:5},playerName:{fontSize:14,marginLeft:10,color:i.statusText},currentPlayerName:{fontWeight:"bold",color:i.currentPlayerText},playerTeamText:{color:i.playerTeamScoreText},points:{fontSize:18,fontWeight:"bold",color:i.teamScoreText}}),c=e.findIndex((e=>e.includes(r))),d=[...e.map(((e,r)=>({teamIndex:r,teamMembers:e,points:t[r]||0,isPlayerTeam:r===c})))].sort(((e,t)=>a?e.points-t.points:t.points-e.points));return(0,S.jsxs)(n.default,{style:s.container,children:[(0,S.jsx)(h.default,{style:[s.title,{color:i.titleText}],children:"Game Finished"}),(0,S.jsx)(h.default,{style:[s.subtitle,{color:i.subtitleText}],children:"Final Scores"}),(0,S.jsx)(R.default,{style:s.scoreList,children:d.map(((e,t)=>{const a=0===t;return(0,S.jsxs)(n.default,{style:[s.teamRow,e.isPlayerTeam&&s.playerTeamRow,a&&s.winnerRow],children:[(0,S.jsxs)(n.default,{style:s.rankAndTeam,children:[(0,S.jsxs)(h.default,{style:[s.rank,e.isPlayerTeam&&s.playerTeamText],children:[t+1,"."]}),(0,S.jsxs)(n.default,{style:s.teamMembers,children:[(0,S.jsxs)(h.default,{style:[s.teamTitle,e.isPlayerTeam&&s.playerTeamText],children:["Team ",e.teamIndex+1," ",e.isPlayerTeam&&"(Your Team)",a&&" \ud83c\udfc6"]}),e.teamMembers.map((t=>{const a=o.find((e=>e.id===t));return(0,S.jsxs)(h.default,{style:[s.playerName,t===r&&s.currentPlayerName,e.isPlayerTeam&&s.playerTeamText],children:[a?.name||"Unknown"," ",t===r&&"(You)",a?.isAgent&&" (AI)"]},t)}))]})]}),(0,S.jsxs)(h.default,{style:[s.points,e.isPlayerTeam&&s.playerTeamText],children:[e.points," pts"]})]},`team-${e.teamIndex}`)}))})]})};let F=function(e){return e.WAITING="WAITING",e.PLAYING="PLAYING",e.FINISHED="FINISHED",e}({});var Y=r(3681);const V=({visible:e,title:t,message:r,onConfirm:o,onCancel:a})=>(0,S.jsx)(Y.default,{transparent:!0,visible:e,animationType:"fade",onRequestClose:a,children:(0,S.jsx)(n.default,{style:J.overlay,children:(0,S.jsxs)(n.default,{style:J.dialog,children:[(0,S.jsx)(h.default,{style:J.title,children:t}),(0,S.jsx)(h.default,{style:J.message,children:r}),(0,S.jsxs)(n.default,{style:J.buttonContainer,children:[(0,S.jsx)(O.default,{style:[J.button,J.cancelButton],onPress:a,children:(0,S.jsx)(h.default,{style:J.buttonText,children:"Cancel"})}),(0,S.jsx)(O.default,{style:[J.button,J.confirmButton],onPress:o,children:(0,S.jsx)(h.default,{style:J.buttonText,children:"Leave Game"})})]})]})})}),J=l.default.create({overlay:{flex:1,backgroundColor:w.dialogOverlay,justifyContent:"center",alignItems:"center"},dialog:{backgroundColor:w.dialogBackground,borderRadius:10,padding:20,width:"80%",maxWidth:400},title:{fontSize:18,fontWeight:"bold",marginBottom:10,textAlign:"center"},message:{fontSize:16,marginBottom:20,textAlign:"center"},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},button:{flex:1,padding:10,borderRadius:5,marginHorizontal:5},cancelButton:{backgroundColor:w.dialogCancelButton},confirmButton:{backgroundColor:w.dialogConfirmButton},buttonText:{color:w.dialogButtonText,textAlign:"center",fontSize:16}});var X=r(698);const Z=({gameId:e,style:t})=>{const[r,o]=(0,a.useState)(!1),n=(0,X.useNavigation)(),i=I.getInstance();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(O.default,{style:[K.leaveButton,t],onPress:()=>o(!0),children:(0,S.jsx)(h.default,{style:K.leaveButtonText,children:"Leave Game"})}),(0,S.jsx)(V,{visible:r,title:"Leave Game",message:"Are you sure you want to leave this game? This action cannot be undone.",onConfirm:async()=>{try{(await i.leaveGame(e)).success?n.reset({index:0,routes:[{name:"Home"}]}):console.error("Failed to leave game")}catch(t){console.error("Error leaving game:",t)}o(!1)},onCancel:()=>o(!1)})]})},K=l.default.create({leaveButton:{backgroundColor:"#d32f2f",padding:10,borderRadius:5,position:"absolute",top:10,right:10},leaveButtonText:{color:"white",fontSize:16,fontWeight:"bold"}}),$=({route:e})=>{const{gameId:t,playerName:r}=e.params,[o,i]=(0,a.useState)(null),[s,c]=(0,a.useState)({mode:"management",isCurrentPlayer:!1}),[d,u]=(0,a.useState)(!1),m=I.getInstance(),{colors:g}=E(),p=(0,X.useNavigation)();console.log("GameScreen mounted with gameId:",t,"and playerName:",r),(0,X.useFocusEffect)((0,a.useCallback)((()=>{const e=()=>(u(!0),!0);return N.default.addEventListener("hardwareBackPress",e),p.setOptions({headerLeft:()=>null}),()=>N.default.removeEventListener("hardwareBackPress",e)}),[p])),(0,a.useEffect)((()=>{console.log("useEffect called");const e=e=>{console.log("handleNotInGame called with data:",e),console.log("currentGameId:",t),console.log("currentUserId:",m.getCurrentUser()?.userId),e.gameId===t&&e.playerId===m.getCurrentUser()?.userId&&(console.log("Navigating to Home screen due to NOT_IN_GAME event"),p.reset({index:0,routes:[{name:"Home"}]}))};return m.on(k.NOT_IN_GAME,e),m.onGameState((e=>{console.log("Game state received:",e),i(e),c((t=>Object.assign({},t,{mode:"PLAYING"===e.public.phase?"playing":"management",isCurrentPlayer:e.public.players[e.public.currentPlayerIndex]?.name===r})))})),()=>{m.off(k.NOT_IN_GAME,e)}}),[t,p]);const f=()=>{m.addAgent(t)},y=()=>{m.startGame(t)},b=e=>{m.playCard(t,e)},x=(e,r)=>{m.extraAction(t,e,r)},T=e=>{m.kickPlayer(t,e)};if(!o)return(0,S.jsx)(h.default,{children:"Loading..."});const C=l.default.create({container:{flex:1,padding:20,position:"relative"},title:{fontSize:24,fontWeight:"bold",marginBottom:20},subtitle:{fontSize:18,fontWeight:"bold",marginBottom:10},controls:{flexDirection:"row",justifyContent:"space-around",marginBottom:20},status:{fontSize:16,marginBottom:20},trickContainer:{marginBottom:20},trick:{flexGrow:0,height:100},handContainer:{marginTop:"auto"},hand:{flexGrow:0,height:100},scoreboard:{marginTop:20}});return(0,S.jsxs)(n.default,{style:[C.container,{backgroundColor:g.containerBackground}],children:[(0,S.jsx)(Z,{gameId:t}),(0,S.jsx)(h.default,{style:[C.title,{color:g.titleText}],children:t}),o.public.phase===F.FINISHED?(0,S.jsx)(z,{teams:o.public.gameSpecificData?.teams||[],gamePoints:o.public.gameSpecificData?.gamePoints||[],playerId:m.getCurrentUser()?.userId||"",players:o.public.players,gamePointsReversed:o.public.gameCharacteristics.gamePointsReversed}):"management"===s.mode?(0,S.jsx)(_,{gameId:t,onAddAgent:f,onStartGame:y,playerCount:o.public.players.length,players:o.public.players.map((e=>Object.assign({},e,{isOwner:e.id===o.public.owner}))),isOwner:m.getCurrentUser()?.userId===o.public.owner,onKickPlayer:T,gameCharacteristics:o.public.gameCharacteristics}):(0,S.jsx)(W,{gameState:o,playerName:r,playerId:m.getCurrentUser()?.userId||"",onPlayCard:b,onExtraAction:x}),(0,S.jsx)(V,{visible:d,title:"Leave Game",message:"Are you sure you want to leave this game? This action cannot be undone.",onConfirm:async()=>{try{(await m.leaveGame(t)).success&&p.reset({index:0,routes:[{name:"Home"}]})}catch(e){console.error("Error leaving game:",e)}u(!1)},onCancel:()=>u(!1)})]})};var q=r(4915);const Q=["SUECA"],ee=({route:e,navigation:t})=>{const{colors:r}=E();console.log("GameCreationScreen rendered"),console.log("Route params:",e.params);const{playerName:o}=e.params,i=I.getInstance(),[s,c]=(0,a.useState)(Q[0]),[d,u]=(0,a.useState)(""),p=l.default.create({container:{flex:1,padding:20},title:{fontSize:24,marginBottom:20},formGroup:{marginBottom:20},label:{marginBottom:10},picker:{padding:10},input:{borderWidth:1,borderColor:r.inputBorder,borderRadius:5,padding:10,color:r.inputText,backgroundColor:r.inputBackground}});return(0,S.jsxs)(n.default,{style:[p.container,{backgroundColor:r.containerBackground}],children:[(0,S.jsx)(h.default,{style:[p.title,{color:r.titleText}],children:"Game Creation"}),(0,S.jsxs)(n.default,{style:p.formGroup,children:[(0,S.jsx)(h.default,{style:[p.label,{color:r.subtitleText}],children:"Select Game Type:"}),(0,S.jsx)(q.Picker,{selectedValue:s,onValueChange:e=>c(e),style:[p.picker,{backgroundColor:r.pickerBackground}],children:Q.map((e=>(0,S.jsx)(q.Picker.Item,{label:e.replace("_"," "),value:e},e)))})]}),(0,S.jsxs)(n.default,{style:p.formGroup,children:[(0,S.jsx)(h.default,{style:[p.label,{color:r.subtitleText}],children:"Game Name (optional):"}),(0,S.jsx)(m.default,{style:p.input,value:d,onChangeText:u,placeholder:"Enter game name or leave blank for random",placeholderTextColor:r.placeholderText})]}),(0,S.jsx)(g.default,{title:"Create Game",onPress:async()=>{console.log("Creating game"),await i.connect(o),console.log("Connected to socket");const e=d.trim()||Math.random().toString(16).substring(2,10),r=await i.createGame(o,s,e);r.success&&r.gameId&&(console.log("Game created successfully"),t.navigate("Game",{gameId:r.gameId,playerName:o}))},color:r.primaryButton})]})},te=({route:e,navigation:t})=>{const{colors:r}=E(),{playerName:o}=e.params,i=I.getInstance(),[s,c]=(0,a.useState)(""),d=l.default.create({container:{flex:1,padding:20,justifyContent:"center"},input:{borderWidth:1,borderColor:r.inputBorder,padding:10,marginBottom:20,borderRadius:5},buttonContainer:{gap:10}});return(0,S.jsxs)(n.default,{style:[d.container,{backgroundColor:r.containerBackground}],children:[(0,S.jsx)(m.default,{style:[d.input,{backgroundColor:r.inputBackground}],placeholder:"Enter game name",onChangeText:e=>c(e),placeholderTextColor:r.playerStatsText}),(0,S.jsx)(g.default,{title:"Join Game",onPress:async()=>{await i.connect(o),await i.joinGame(s,o),t.navigate("Game",{gameId:s,playerName:o})},color:r.primaryButton})]})};var re=r(1174);const oe=()=>{const{toggleTheme:e,themeType:t}=E();return(0,S.jsx)(O.default,{style:ae.button,onPress:e,accessibilityLabel:"Toggle theme",accessibilityRole:"button",children:(0,S.jsx)(re.default,{name:"light"===t?"moon-outline":"sunny-outline",size:22,color:"light"===t?"#333":"#fff"})})},ae=l.default.create({button:{marginRight:8,padding:8}}),ne=(0,d.createStackNavigator)();(0,u.createNativeStackNavigator)();const ie=()=>{const e=ne,{colors:t,themeType:r}=E(),o=Object.assign({},s.DefaultTheme,{colors:Object.assign({},s.DefaultTheme.colors,{background:t.appBackground,card:t.containerBackground,text:t.titleText,border:t.inputBorder,primary:t.primaryButton})});return(0,S.jsxs)(n.default,{style:[le.container,{backgroundColor:t.appBackground}],children:[(0,S.jsx)(i.default,{backgroundColor:t.appBackground,barStyle:"dark"===r?"light-content":"dark-content"}),(0,S.jsx)(c.NavigationContainer,{theme:o,children:(0,S.jsxs)(e.Navigator,{initialRouteName:"Login",screenOptions:{headerShown:!0,headerStyle:{backgroundColor:t.containerBackground,borderBottomColor:t.inputBorder,borderBottomWidth:1},headerTitleStyle:{color:t.titleText},headerTintColor:t.titleText,headerRight:()=>(0,S.jsx)(oe,{})},children:[(0,S.jsx)(e.Screen,{name:"Login",component:G,options:{title:"Sign In",headerLeft:()=>null}}),(0,S.jsx)(e.Screen,{name:"Home",component:P,options:{title:"Home",headerLeft:()=>null}}),(0,S.jsx)(e.Screen,{name:"Game",component:$}),(0,S.jsx)(e.Screen,{name:"GameCreation",component:ee,options:{title:"Create Game"}}),(0,S.jsx)(e.Screen,{name:"JoinGame",component:te,options:{title:"Join Game"}})]})})]})},le=l.default.create({container:{flex:1}});(0,o.default)((function(){return(0,S.jsx)(A,{children:(0,S.jsx)(ie,{})})}))},9251:(e,t,r)=>{r.r(t),r.d(t,{default:()=>o});const o={}}},t={};function r(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.m=e,(()=>{var e=[];r.O=(t,o,a,n)=>{if(!o){var i=1/0;for(d=0;d<e.length;d++){for(var[o,a,n]=e[d],l=!0,s=0;s<o.length;s++)(!1&n||i>=n)&&Object.keys(r.O).every((e=>r.O[e](o[s])))?o.splice(s--,1):(l=!1,n<i&&(i=n));if(l){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[o,a,n]}})(),r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="./",(()=>{var e={792:0};r.O.j=t=>0===e[t];var t=(t,o)=>{var a,n,[i,l,s]=o,c=0;if(i.some((t=>0!==e[t]))){for(a in l)r.o(l,a)&&(r.m[a]=l[a]);if(s)var d=s(r)}for(t&&t(o);c<i.length;c++)n=i[c],r.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return r.O(d)},o=self.webpackChunkweb=self.webpackChunkweb||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=r.O(void 0,[4],(()=>r(6536)));o=r.O(o)})();
//# sourceMappingURL=main.9b02a25c.js.map